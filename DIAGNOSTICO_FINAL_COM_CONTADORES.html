<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico de Cole√ß√£o - Vers√£o Gratuita</title>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e1e1e 0%, #2d2d2d 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #d4af37, #f4e5b1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            color: #999;
            font-size: 1.1em;
        }

        .badge {
            display: inline-block;
            background: rgba(212, 175, 55, 0.2);
            color: #d4af37;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            margin-top: 10px;
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        /* QUIZ STYLES */
        .quiz-section {
            display: none;
        }

        .quiz-section.active {
            display: block;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
        }

        .question-number {
            color: #d4af37;
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .question-title {
            color: white;
            font-size: 1.8em;
            font-weight: 700;
            margin-bottom: 40px;
            line-height: 1.4;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .option-btn {
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid rgba(212, 175, 55, 0.3);
            color: white;
            padding: 20px;
            border-radius: 12px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .option-btn:hover {
            background: rgba(212, 175, 55, 0.2);
            border-color: #d4af37;
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.3);
        }

        .option-btn.selected {
            background: linear-gradient(135deg, #d4af37, #f4e5b1);
            color: #1e1e1e;
            border-color: #d4af37;
        }

        .next-btn {
            background: linear-gradient(135deg, #d4af37, #f4e5b1);
            color: #1e1e1e;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0.5;
            pointer-events: none;
        }

        .next-btn.enabled {
            opacity: 1;
            pointer-events: all;
        }

        .next-btn.enabled:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.5);
        }

        .section-title {
            color: white;
            font-size: 1.8em;
            margin: 40px 0 20px 0;
            text-align: center;
        }

        .interactive-note {
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 40px;
            text-align: center;
            color: #9bc4ff;
        }

        .section-title {
            display: flex;
            justify-content: center;
            margin-top: 30px;
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 15px;
            padding: 40px;
            width: 100%;
        }

        .balance-title {
            color: #d4af37;
            font-size: 1.8em;
            margin-bottom: 15px;
            text-align: center;
        }

        .balance-description {
            color: #ccc;
            text-align: center;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .context-section {
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        #grid-contexto-cta .context-section {
            margin-bottom: 0;
            height: 100%;
        }

        .context-title {
            color: #9bc4ff;
            font-size: 1.2em;
            font-weight: 600;
            margin-bottom: 15px;
            text-align: center;
        }

        .context-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .context-item label {
            color: #9bc4ff;
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .context-item input[type="text"],
        .context-item input[type="number"] {
            width: 100%;
            padding: 10px;
            font-size: 1em;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(100, 150, 255, 0.3);
            border-radius: 5px;
            color: white;
        }

        .context-item input[type="text"]:focus,
        .context-item input[type="number"]:focus {
            outline: none;
            border-color: #9bc4ff;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ccc;
            cursor: pointer;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            transition: all 0.2s ease;
        }

        .checkbox-label:hover {
            background: rgba(100, 150, 255, 0.1);
        }

        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .family-counter {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        @media (max-width: 768px) {
            .family-counter {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px !important;
                padding: 0 !important;
                margin: 0 !important;
            }
        }
        }
        }

        .counter-item {
            background: rgba(212, 175, 55, 0.1);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .counter-item label {
            color: #d4af37;
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .counter-item input {
            width: 100%;
            padding: 10px;
            font-size: 1.2em;
            text-align: center;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(212, 175, 55, 0.3);
            border-radius: 5px;
            color: white;
        }

        .counter-item input:focus {
            outline: none;
            border-color: #d4af37;
        }

        .analyze-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            font-weight: 600;
            background: linear-gradient(90deg, #d4af37, #f4e5b1);
            color: #1e1e1e;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.4);
        }

        .result-box {
            margin-top: 30px;
            background: rgba(212, 175, 55, 0.1);
            border: 2px solid #d4af37;
            border-radius: 10px;
            padding: 25px;
        }

        .result-title {
            color: #d4af37;
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .result-content {
            color: white;
            font-size: 1.1em;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .result-advice {
            color: #ccc;
            line-height: 1.8;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .result-next {
            color: #9bc4ff;
            background: rgba(100, 150, 255, 0.1);
            border: 2px solid rgba(100, 150, 255, 0.3);
            padding: 15px;
            border-radius: 8px;
            line-height: 1.8;
        }

        .result-next strong {
            color: #fff;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }

            .options-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '804720092315209');
    fbq('track', 'PageView');
    </script>
    <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=804720092315209&ev=PageView&noscript=1"
    /></noscript>
    <!-- End Meta Pixel Code -->
</head>
<body>
    <div class="container">
        <header>
            <h1>DIAGN√ìSTICO DE COLE√á√ÉO</h1>
            <p class="subtitle">Descubra se sua cole√ß√£o est√° equilibrada</p>
            <span class="badge">üÜì VERS√ÉO GRATUITA</span>
        </header>

        <!-- PR√â-P√ÅGINA: BIFURCA√á√ÉO INICIAL -->
        <div id="hero-section" class="quiz-section active">
            <div class="question-card" style="padding: 50px 40px;">
                <div style="text-align: center; margin-bottom: 40px;">
                    <h2 style="color: #fff; font-size: 2em; margin-bottom: 15px; line-height: 1.3;">
                        üéØ Qual √© a sua situa√ß√£o com perfumes?
                    </h2>
                    <p style="color: #ccc; font-size: 1.1em; line-height: 1.6;">
                        Escolha a op√ß√£o que melhor descreve voc√™ para receber a orienta√ß√£o ideal
                    </p>
                </div>

                <!-- GRID DE 2 CARDS -->
                <div style="
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 25px;
                    margin-bottom: 0;
                ">
                    <!-- CARD 1: INICIANTE TOTAL (VERMELHO) -->
                    <div style="
                        background: linear-gradient(135deg, rgba(255, 100, 100, 0.15) 0%, rgba(255, 100, 100, 0.05) 100%);
                        border: 3px solid rgba(255, 100, 100, 0.4);
                        border-radius: 20px;
                        padding: 35px 30px;
                        text-align: center;
                        transition: all 0.3s ease;
                        cursor: pointer;
                        box-shadow: 0 10px 30px rgba(255, 100, 100, 0.2);
                    " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(255, 100, 100, 0.4)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(255, 100, 100, 0.2)';">
                        <div style="font-size: 3em; margin-bottom: 15px;">ü§∑‚Äç‚ôÇÔ∏è</div>
                        
                        <!-- CONTADOR SOCIAL PROOF -->
                        <div style="
                            display: inline-block;
                            padding: 6px 14px;
                            background: rgba(255, 100, 100, 0.2);
                            border: 1px solid rgba(255, 100, 100, 0.4);
                            border-radius: 20px;
                            margin-bottom: 15px;
                        ">
                            <span style="color: #ffcccc; font-size: 0.85em; font-weight: 600;">
                                üî• <span id="counter-iniciante">...</span> pessoas descobriram a perfumaria hoje
                            </span>
                        </div>
                        
                        <h3 style="color: #ff9999; font-size: 1.4em; font-weight: 700; margin-bottom: 15px;">
                            N√ÉO SEI NADA
                        </h3>
                        <p style="color: #ccc; font-size: 1em; margin-bottom: 25px; line-height: 1.6;">
                            N√£o domino perfumaria e quero come√ßar do zero com orienta√ß√£o profissional
                        </p>
                        <button onclick="trackCTAClick('N√£o Sei Nada (Hero)'); abrirPopupIniciante();" style="
                            width: 100%;
                            padding: 18px 25px;
                            font-size: 1.1em;
                            font-weight: 700;
                            background: linear-gradient(135deg, #ff6666 0%, #ff4444 100%);
                            border: none;
                            color: #fff;
                            border-radius: 12px;
                            cursor: pointer;
                            box-shadow: 0 8px 25px rgba(255, 100, 100, 0.4);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='scale(1.05)';" onmouseout="this.style.transform='scale(1)';">
                            ‚ùå COME√áAR DO ZERO
                        </button>
                    </div>

                    <!-- CARD 2: J√Å TEM COLE√á√ÉO (DOURADO/VERDE) -->
                    <div style="
                        background: linear-gradient(135deg, rgba(212, 175, 55, 0.15) 0%, rgba(212, 175, 55, 0.05) 100%);
                        border: 3px solid rgba(212, 175, 55, 0.6);
                        border-radius: 20px;
                        padding: 35px 30px;
                        text-align: center;
                        transition: all 0.3s ease;
                        cursor: pointer;
                        box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3);
                    " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(212, 175, 55, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(212, 175, 55, 0.3)';">
                        <div style="font-size: 3em; margin-bottom: 15px;">üìà</div>
                        
                        <!-- CONTADOR SOCIAL PROOF -->
                        <div style="
                            display: inline-block;
                            padding: 6px 14px;
                            background: rgba(212, 175, 55, 0.2);
                            border: 1px solid rgba(212, 175, 55, 0.5);
                            border-radius: 20px;
                            margin-bottom: 15px;
                        ">
                            <span style="color: #f4e5b1; font-size: 0.85em; font-weight: 600;">
                                ‚ú® <span id="counter-colecao">...</span> pessoas melhoraram suas cole√ß√µes hoje
                            </span>
                        </div>
                        
                        <h3 style="color: #f4e5b1; font-size: 1.4em; font-weight: 700; margin-bottom: 15px;">
                            TENHO COLE√á√ÉO
                        </h3>
                        <p style="color: #ccc; font-size: 1em; margin-bottom: 25px; line-height: 1.6;">
                            J√° tenho perfumes mas quero melhorar e equilibrar minha cole√ß√£o
                        </p>
                        <button onclick="comecarDiagnostico();" style="
                            width: 100%;
                            padding: 18px 25px;
                            font-size: 1.1em;
                            font-weight: 700;
                            background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                            border: none;
                            color: #000;
                            border-radius: 12px;
                            cursor: pointer;
                            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5);
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='scale(1.05)';" onmouseout="this.style.transform='scale(1)';">
                            ‚úÖ MELHORAR COLE√á√ÉO
                        </button>
                    </div>
                </div>

                <!-- Media Query para Mobile -->
                <style>
                    @media (max-width: 768px) {
                        #hero-section .question-card > div:nth-child(2) {
                            grid-template-columns: 1fr !important;
                        }
                    }
                </style>
            </div>
        </div>

        <!-- QUIZ SECTION - Perguntas de qualifica√ß√£o -->
        <!-- QUIZ SECTION - Perguntas de qualifica√ß√£o -->
        <div id="quiz-1" class="quiz-section">
            <div class="question-card">
                <!-- BARRA DE PROGRESSO -->
                <div style="margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="color: #d4af37; font-size: 0.9em; font-weight: 600;">PERGUNTA 1 DE 3</span>
                        <span style="color: #888; font-size: 0.85em;">33% completo</span>
                    </div>
                    <div style="width: 100%; height: 8px; background: rgba(212, 175, 55, 0.2); border-radius: 10px; overflow: hidden;">
                        <div style="width: 33%; height: 100%; background: linear-gradient(90deg, #d4af37, #f4e5b1); border-radius: 10px; transition: width 0.3s ease;"></div>
                    </div>
                </div>

                <div class="question-title" style="font-size: 1.6em; margin-bottom: 10px;">üëã Voc√™ j√° usa perfume?</div>
                <div style="color: #888; font-size: 0.95em; margin-bottom: 25px; line-height: 1.5;">
                    Queremos entender seu n√≠vel atual para personalizar suas recomenda√ß√µes
                </div>
                <div class="options-grid">
                    <button class="option-btn" onclick="selectOption(1, 'sim-sempre', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">‚úÖ</span><br>Sim, sempre
                    </button>
                    <button class="option-btn" onclick="selectOption(1, 'quando-lembro', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">ü§î</span><br>Quando lembro
                    </button>
                    <button class="option-btn" onclick="selectOption(1, 'nao-ligo', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">üòê</span><br>N√£o ligo muito
                    </button>
                    <button class="option-btn" onclick="selectOption(1, 'nao-sei', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">‚ùì</span><br>N√£o sei nada
                    </button>
                </div>
                <button class="next-btn" id="next-1" onclick="nextQuestion(1)">Pr√≥xima ‚Üí</button>
            </div>
        </div>

        <div id="quiz-2" class="quiz-section">
            <div class="question-card">
                <div style="margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="color: #d4af37; font-size: 0.9em; font-weight: 600;">PERGUNTA 2 DE 3</span>
                        <span style="color: #888; font-size: 0.85em;">66% completo</span>
                    </div>
                    <div style="width: 100%; height: 8px; background: rgba(212, 175, 55, 0.2); border-radius: 10px; overflow: hidden;">
                        <div style="width: 66%; height: 100%; background: linear-gradient(90deg, #d4af37, #f4e5b1); border-radius: 10px; transition: width 0.3s ease;"></div>
                    </div>
                </div>

                <div class="question-title" style="font-size: 1.6em; margin-bottom: 10px;">ü§Ø Qual sua MAIOR dificuldade?</div>
                <div style="color: #888; font-size: 0.95em; margin-bottom: 25px; line-height: 1.5;">
                    Isso ajuda a identificar onde voc√™ precisa de mais orienta√ß√£o
                </div>
                <div class="options-grid">
                    <button class="option-btn" onclick="selectOption(2, 'mesmo-tipo', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">üîÅ</span><br>Compro sempre o mesmo tipo
                    </button>
                    <button class="option-btn" onclick="selectOption(2, 'muitas-opcoes', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">ü§∑</span><br>Muitas op√ß√µes, n√£o sei qual escolher
                    </button>
                    <button class="option-btn" onclick="selectOption(2, 'influenciador', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">üí∏</span><br>Sigo influencer e perco dinheiro
                    </button>
                    <button class="option-btn" onclick="selectOption(2, 'nao-compro', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">üö´</span><br>Nunca compro perfume
                    </button>
                </div>
                <button class="next-btn" id="next-2" onclick="nextQuestion(2)">Pr√≥xima ‚Üí</button>
            </div>
        </div>

        <div id="quiz-3" class="quiz-section">
            <div class="question-card">
                <div style="margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="color: #d4af37; font-size: 0.9em; font-weight: 600;">PERGUNTA 3 DE 3</span>
                        <span style="color: #888; font-size: 0.85em;">99% completo</span>
                    </div>
                    <div style="width: 100%; height: 8px; background: rgba(212, 175, 55, 0.2); border-radius: 10px; overflow: hidden;">
                        <div style="width: 99%; height: 100%; background: linear-gradient(90deg, #d4af37, #f4e5b1); border-radius: 10px; transition: width 0.3s ease;"></div>
                    </div>
                </div>

                <div class="question-title" style="font-size: 1.6em; margin-bottom: 10px;">üí∞ Quanto quer investir por perfume?</div>
                <div style="color: #888; font-size: 0.95em; margin-bottom: 25px; line-height: 1.5;">
                    Vamos recomendar op√ß√µes que cabem no seu bolso
                </div>
                <div class="options-grid">
                    <button class="option-btn" onclick="selectOption(3, 'ate-350', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">üíµ</span><br>At√© R$ 350
                        <div style="font-size: 0.75em; color: #888; margin-top: 5px;">Nacionais e inspirados</div>
                    </button>
                    <button class="option-btn" onclick="selectOption(3, '350-1500', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">üí≥</span><br>R$ 350 a R$ 1.500
                        <div style="font-size: 0.75em; color: #888; margin-top: 5px;">Designers importados</div>
                    </button>
                    <button class="option-btn" onclick="selectOption(3, '1500-2500', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">üíé</span><br>R$ 1.500 a R$ 2.500
                        <div style="font-size: 0.75em; color: #888; margin-top: 5px;">Marcas premium</div>
                    </button>
                    <button class="option-btn" onclick="selectOption(3, 'sem-limite', this)">
                        <span style="font-size: 1.3em; margin-bottom: 5px;">üëë</span><br>Sem limite
                        <div style="font-size: 0.75em; color: #888; margin-top: 5px;">Nichos exclusivos</div>
                    </button>
                </div>
                <button class="next-btn" id="next-3" onclick="startDiagnostic()">Iniciar Diagn√≥stico ‚Üí</button>
            </div>
        </div>

        <!-- DIAGNOSTIC SECTION -->
        <div id="diagnostic-section" style="display: none;">
            <h2 class="section-title">üéØ DIAGN√ìSTICO: SUA COLE√á√ÉO EST√Å EQUILIBRADA?</h2>
            
            <!-- WRAPPER GERAL ALINHADO -->
            <div style="max-width: 900px; margin: 0 auto;">
                
                <!-- T√çTULO -->
                <div class="balance-section">
                    <div class="balance-card">
                        <div class="balance-title">Identifique sua fam√≠lia dominante</div>
                        <div class="balance-description">
                            Conte quantos perfumes voc√™ tem de cada fam√≠lia. A fam√≠lia com mais perfumes √© sua dominante.
                        </div>
                    </div>
                </div>

                <!-- GRID: Contexto Pessoal -->
                <div id="grid-contexto-cta" style="
                    display: grid;
                    grid-template-columns: 1fr;
                    gap: 25px;
                    margin-bottom: 30px;
                    align-items: stretch;
                ">
                <!-- CONTEXTO PESSOAL -->
                <div class="context-section">
                    <div class="context-title">üìç Contexto Pessoal</div>
                    
                    <!-- AMBIENTE DE TRABALHO -->
                    <div class="context-item" style="margin-bottom: 20px;">
                        <label style="margin-bottom: 10px; display: block; color: #9bc4ff; font-weight: 600;">üíº Ambiente de trabalho:</label>
                        <select id="ambiente" style="
                            width: 100%;
                            padding: 12px 15px;
                            font-size: 1em;
                            background: rgba(0, 0, 0, 0.3);
                            border: 2px solid rgba(100, 150, 255, 0.3);
                            border-radius: 8px;
                            color: white;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onfocus="this.style.borderColor='#9bc4ff'" onblur="this.style.borderColor='rgba(100, 150, 255, 0.3)'">
                            <option value="" selected disabled>Selecione seu ambiente</option>
                            <option value="fechado">Fechado (escrit√≥rio, loja)</option>
                            <option value="aberto">Aberto (obra, rua, campo)</option>
                            <option value="ambos">Ambos</option>
                        </select>
                    </div>
                    
                    <!-- CLIMA DA REGI√ÉO -->
                    <div class="context-item">
                        <label style="margin-bottom: 10px; display: block; color: #9bc4ff; font-weight: 600;">üå°Ô∏è Clima da sua regi√£o:</label>
                        <input type="hidden" id="clima" value="temperado">
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button type="button" onclick="selecionarClima('quente', this)" class="clima-btn" style="
                                flex: 1;
                                padding: 15px 10px;
                                background: rgba(255, 100, 100, 0.1);
                                border: 2px solid rgba(255, 100, 100, 0.3);
                                color: white;
                                border-radius: 10px;
                                cursor: pointer;
                                font-size: 0.95em;
                                transition: all 0.3s;
                                text-align: center;
                            ">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">‚òÄÔ∏è</div>
                                <div style="font-weight: 600;">Quente</div>
                                <div style="font-size: 0.75em; color: #888; margin-top: 3px;">Norte, Nordeste</div>
                            </button>
                            
                            <button type="button" onclick="selecionarClima('temperado', this)" class="clima-btn" style="
                                flex: 1;
                                padding: 15px 10px;
                                background: rgba(212, 175, 55, 0.3);
                                border: 2px solid #d4af37;
                                color: white;
                                border-radius: 10px;
                                cursor: pointer;
                                font-size: 0.95em;
                                transition: all 0.3s;
                                text-align: center;
                                box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
                            ">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">üå§Ô∏è</div>
                                <div style="font-weight: 600;">Temperado</div>
                                <div style="font-size: 0.75em; color: #888; margin-top: 3px;">Sudeste</div>
                            </button>
                            
                            <button type="button" onclick="selecionarClima('frio', this)" class="clima-btn" style="
                                flex: 1;
                                padding: 15px 10px;
                                background: rgba(150, 200, 255, 0.1);
                                border: 2px solid rgba(150, 200, 255, 0.3);
                                color: white;
                                border-radius: 10px;
                                cursor: pointer;
                                font-size: 0.95em;
                                transition: all 0.3s;
                                text-align: center;
                            ">
                                <div style="font-size: 1.5em; margin-bottom: 5px;">‚ùÑÔ∏è</div>
                                <div style="font-weight: 600;">Frio</div>
                                <div style="font-size: 0.75em; color: #888; margin-top: 3px;">Sul</div>
                            </button>
                        </div>
                        
                        <style>
                            .clima-btn:hover {
                                transform: translateY(-3px) scale(1.05);
                            }
                            
                            /* Hover personalizado por clima */
                            .clima-btn:hover {
                                box-shadow: 0 8px 25px rgba(212, 175, 55, 0.6);
                                border-color: #d4af37;
                            }
                            
                            /* QUENTE - Vermelho/Laranja */
                            .clima-btn.selected-quente {
                                background: rgba(255, 100, 100, 0.3) !important;
                                border-color: #ff6666 !important;
                                box-shadow: 0 0 20px rgba(255, 100, 100, 0.6) !important;
                            }
                            
                            /* TEMPERADO - Amarelo/Dourado */
                            .clima-btn.selected-temperado {
                                background: rgba(212, 175, 55, 0.3) !important;
                                border-color: #d4af37 !important;
                                box-shadow: 0 0 20px rgba(212, 175, 55, 0.5) !important;
                            }
                            
                            /* FRIO - Azul */
                            .clima-btn.selected-frio {
                                background: rgba(100, 150, 255, 0.3) !important;
                                border-color: #6699ff !important;
                                box-shadow: 0 0 20px rgba(100, 150, 255, 0.6) !important;
                            }
                        </style>
                    </div>
                </div>
            </div>
            
            <!-- Media Query para Mobile -->
            <style>
                @media (max-width: 768px) {
                    #grid-contexto-cta {
                        grid-template-columns: 1fr !important;
                    }
                }
            </style>
                    

                <!-- FAM√çLIAS OLFATIVAS -->
                <div class="balance-section">
                    <div class="balance-card">
                        <div style="text-align: center; margin-bottom: 25px;">
                            <div style="color: #d4af37; font-size: 1.5em; font-weight: 700; margin-bottom: 10px;">
                                üìä Quais fam√≠lias voc√™ TEM na sua cole√ß√£o?
                            </div>
                            <div style="color: #ccc; font-size: 0.95em; line-height: 1.6;">
                                Marque todas as fam√≠lias que voc√™ possui (m√≠nimo 1)
                            </div>
                        </div>
                        
                        
                        <div class="family-counter">
                            <label class="checkbox-label-familia" style="cursor: pointer; padding: 8px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(212, 175, 55, 0.3); border-radius: 10px; transition: all 0.3s;">
                                <input type="checkbox" class="familia-checkbox" data-familia="fresco" data-name="üçã Fresco/C√≠trico">
                                <span style="font-size: 0.95em; color: #fff;">üçã Fresco/C√≠trico</span>
                            </label>
                            
                            <label class="checkbox-label-familia" style="cursor: pointer; padding: 8px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(212, 175, 55, 0.3); border-radius: 10px; transition: all 0.3s;">
                                <input type="checkbox" class="familia-checkbox" data-familia="aromatico" data-name="üåø Arom√°tico/Verde">
                                <span style="font-size: 0.95em; color: #fff;">üåø Arom√°tico/Verde</span>
                            </label>
                            
                            <label class="checkbox-label-familia" style="cursor: pointer; padding: 8px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(212, 175, 55, 0.3); border-radius: 10px; transition: all 0.3s;">
                                <input type="checkbox" class="familia-checkbox" data-familia="doce" data-name="üçØ Doce/Gourmand">
                                <span style="font-size: 0.95em; color: #fff;">üçØ Doce/Gourmand</span>
                            </label>
                            
                            <label class="checkbox-label-familia" style="cursor: pointer; padding: 8px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(212, 175, 55, 0.3); border-radius: 10px; transition: all 0.3s;">
                                <input type="checkbox" class="familia-checkbox" data-familia="amadeirado" data-name="ü™µ Amadeirado">
                                <span style="font-size: 0.95em; color: #fff;">ü™µ Amadeirado</span>
                            </label>
                            
                            <label class="checkbox-label-familia" style="cursor: pointer; padding: 8px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(212, 175, 55, 0.3); border-radius: 10px; transition: all 0.3s;">
                                <input type="checkbox" class="familia-checkbox" data-familia="especiado" data-name="üî• Especiado/Oriental">
                                <span style="font-size: 0.95em; color: #fff;">üî• Especiado/Oriental</span>
                            </label>
                            
                            <label class="checkbox-label-familia" style="cursor: pointer; padding: 8px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(212, 175, 55, 0.3); border-radius: 10px; transition: all 0.3s;">
                                <input type="checkbox" class="familia-checkbox" data-familia="aquatico" data-name="üåä Aqu√°tico">
                                <span style="font-size: 0.95em; color: #fff;">üåä Aqu√°tico</span>
                            </label>
                            
                            <label class="checkbox-label-familia" style="cursor: pointer; padding: 8px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(212, 175, 55, 0.3); border-radius: 10px; transition: all 0.3s;">
                                <input type="checkbox" class="familia-checkbox" data-familia="talco" data-name="üßº Talco/Foug√®re">
                                <span style="font-size: 0.95em; color: #fff;">üßº Talco/Foug√®re</span>
                            </label>
                            
                            <label class="checkbox-label-familia" style="cursor: pointer; padding: 8px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(212, 175, 55, 0.3); border-radius: 10px; transition: all 0.3s;">
                                <input type="checkbox" class="familia-checkbox" data-familia="floral" data-name="üå∏ Floral">
                                <span style="font-size: 0.95em; color: #fff;">üå∏ Floral</span>
                            </label>
                            
                            <label class="checkbox-label-familia" style="cursor: pointer; padding: 8px; background: rgba(255, 255, 255, 0.05); border: 2px solid rgba(212, 175, 55, 0.3); border-radius: 10px; transition: all 0.3s;">
                                <input type="checkbox" class="familia-checkbox" data-familia="frutas" data-name="üçì Frutas">
                                <span style="font-size: 0.95em; color: #fff;">üçì Frutas</span>
                            </label>
                        </div>
                        
                        <style>
                            .checkbox-label-familia input[type="checkbox"] {
                                margin-right: 8px;
                            }
                            .checkbox-label-familia:hover {
                                background: rgba(212, 175, 55, 0.15) !important;
                                border-color: #d4af37 !important;
                            }
                            .checkbox-label-familia input[type="checkbox"]:checked + span {
                                color: #d4af37;
                                font-weight: 700;
                            }
                            .checkbox-label-familia:has(input:checked) {
                                background: rgba(212, 175, 55, 0.2) !important;
                                border-color: #d4af37 !important;
                                box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
                            }
                        </style>

                    <button class="analyze-btn" onclick="analyzeCollection()">ANALISAR COLE√á√ÉO</button>
                </div>
            </div>
            </div> <!-- Fecha wrapper alinhado -->

                    <div id="result" class="result-box" style="display: none;">
                        <div class="result-title">üìä RESULTADO DA AN√ÅLISE</div>
                        <div id="dominant-family" class="result-content"></div>
                        <div id="balance-advice" class="result-advice"></div>
                        <div id="next-purchase" class="result-next"></div>
                        
                        <!-- Bot√£o de I.A. que abre popup de convers√£o -->
                    </div>
        </div>
    </div>

    <!-- POPUP DE EXIT INTENT -->
    <div id="popup-exit-intent" style="display: none;">
        <div style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            padding: 20px;
        ">
            <div style="
                background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                border: 3px solid #ff6b6b;
                border-radius: 20px;
                padding: 40px;
                max-width: 550px;
                width: 100%;
                box-shadow: 0 20px 60px rgba(255, 107, 107, 0.5);
                text-align: center;
                position: relative;
            ">
                <!-- Bot√£o Fechar -->
                <div onclick="fecharExitPopup()" style="
                    position: absolute;
                    top: 15px;
                    right: 15px;
                    cursor: pointer;
                    color: #999;
                    font-size: 1.5em;
                    width: 35px;
                    height: 35px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 50%;
                    transition: all 0.3s;
                "
                onmouseover="this.style.background='rgba(255,255,255,0.1)'; this.style.color='#fff'"
                onmouseout="this.style.background='transparent'; this.style.color='#999'"
                >‚úï</div>
                
                <div style="font-size: 2.5em; margin-bottom: 15px;">‚ö†Ô∏è</div>
                
                <div style="color: #ff6b6b; font-size: 1.8em; font-weight: 700; margin-bottom: 15px; line-height: 1.3;">
                    Espera! Oferta Especial!
                </div>
                
                <div style="color: #fff; font-size: 1.1em; margin-bottom: 20px; line-height: 1.6;">
                    Voc√™ ia receber <strong style="color: #999; text-decoration: line-through;">1 sugest√£o</strong>...<br>
                    Mas vou te dar <strong style="color: #d4af37; font-size: 1.2em;">2 SUGEST√ïES</strong> ao inv√©s de 1!
                </div>
                
                <div style="
                    background: rgba(212, 175, 55, 0.1);
                    border: 2px solid rgba(212, 175, 55, 0.3);
                    border-radius: 12px;
                    padding: 20px;
                    margin-bottom: 25px;
                ">
                    <div style="color: #d4af37; font-size: 1em; font-weight: 600; margin-bottom: 10px;">
                        üéÅ UPGRADE GRATUITO:
                    </div>
                    <div style="color: #fff; font-size: 0.95em; line-height: 1.6;">
                        Digite seu email e receba <strong style="color: #d4af37;">2 SUGEST√ïES PERSONALIZADAS</strong> ao inv√©s de apenas 1!
                    </div>
                </div>
                
                <!-- Mensagem de erro (rate limit) -->
                <div id="exit-error-msg" style="
                    display: none;
                    background: rgba(255, 107, 107, 0.2);
                    border: 2px solid rgba(255, 107, 107, 0.5);
                    border-radius: 8px;
                    padding: 15px;
                    margin-bottom: 20px;
                    color: #ff6b6b;
                    font-size: 0.9em;
                "></div>
                
                <!-- Mensagem de sucesso -->
                <div id="exit-success-msg" style="
                    display: none;
                    background: rgba(78, 205, 196, 0.2);
                    border: 2px solid rgba(78, 205, 196, 0.5);
                    border-radius: 8px;
                    padding: 15px;
                    margin-bottom: 20px;
                    color: #4ecdc4;
                    font-size: 0.9em;
                "></div>
                
                <form id="form-exit-intent" onsubmit="enviarExitIntent(event); return false;">
                    <input 
                        type="email" 
                        id="exit-email" 
                        placeholder="Seu melhor e-mail" 
                        required
                        style="
                            width: 100%;
                            padding: 15px;
                            margin-bottom: 15px;
                            font-size: 1.1em;
                            background: rgba(0, 0, 0, 0.3);
                            border: 2px solid rgba(212, 175, 55, 0.3);
                            border-radius: 10px;
                            color: white;
                            box-sizing: border-box;
                        "
                        onfocus="this.style.borderColor='#d4af37'"
                        onblur="this.style.borderColor='rgba(212, 175, 55, 0.3)'"
                    >
                    
                    <button type="submit" id="exit-submit-btn" style="
                        width: 100%;
                        background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                        color: #000;
                        border: none;
                        padding: 18px 30px;
                        border-radius: 12px;
                        font-size: 1.1em;
                        font-weight: 700;
                        cursor: pointer;
                        box-shadow: 0 8px 25px rgba(212, 175, 55, 0.5);
                        transition: all 0.3s;
                        text-transform: uppercase;
                        margin-bottom: 15px;
                    "
                    onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 35px rgba(212, 175, 55, 0.7)'"
                    onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(212, 175, 55, 0.5)'"
                    >
                        üéÅ SIM, QUERO 2 SUGEST√ïES!
                    </button>
                </form>
                
                <div style="color: #888; font-size: 0.85em; line-height: 1.5;">
                    ‚úÖ Sem spam. 2 perfumes ideais para voc√™.<br>
                    ‚ö° Envio instant√¢neo.
                </div>
            </div>
        </div>
    </div>


    <!-- POPUP DE CAPTURA (NOME + EMAIL) -->
    <div id="popup-captura" style="display: none;">
        <div style="
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            padding: 20px;
        ">
            <div style="
                background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                border: 3px solid #d4af37;
                border-radius: 20px;
                padding: 50px;
                max-width: 600px;
                width: 100%;
                box-shadow: 0 20px 60px rgba(212, 175, 55, 0.5);
                text-align: center;
                position: relative;
            ">
                <!-- Bot√£o X de Sa√≠da -->
                <div onclick="abrirPopupSaidaDiferenciado()" style="
                    position: absolute;
                    top: 15px;
                    left: 15px;
                    cursor: pointer;
                    color: #999;
                    font-size: 1.8em;
                    width: 40px;
                    height: 40px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    border-radius: 50%;
                    transition: all 0.3s;
                    font-weight: 700;
                "
                onmouseover="this.style.background='rgba(255,107,107,0.2)'; this.style.color='#ff6b6b'; this.style.transform='rotate(90deg)'"
                onmouseout="this.style.background='transparent'; this.style.color='#999'; this.style.transform='rotate(0deg)'"
                title="Sair"
                >‚úï</div>
                
                <div style="font-size: 3em; margin-bottom: 20px;">üîì</div>
                
                <div style="color: #d4af37; font-size: 2em; font-weight: 700; margin-bottom: 20px; line-height: 1.3;">
                    Desbloqueie seu<br>Diagn√≥stico Personalizado!
                </div>
                
                <div style="color: #ccc; font-size: 1.1em; margin-bottom: 30px; line-height: 1.6;">
                    Receba seu diagn√≥stico completo por email<br>
                    + recomenda√ß√µes personalizadas de perfumes!
                </div>
                
                <form id="form-captura" style="margin-bottom: 20px;">
                    <input 
                        type="text" 
                        id="capture-name" 
                        placeholder="Seu nome" 
                        required
                        style="
                            width: 100%;
                            padding: 15px;
                            margin-bottom: 15px;
                            font-size: 1.1em;
                            background: rgba(0, 0, 0, 0.3);
                            border: 2px solid rgba(212, 175, 55, 0.3);
                            border-radius: 10px;
                            color: white;
                        "
                        onfocus="this.style.borderColor='#d4af37'"
                        onblur="this.style.borderColor='rgba(212, 175, 55, 0.3)'"
                    >
                    
                    <input 
                        type="email" 
                        id="capture-email" 
                        placeholder="Seu melhor e-mail" 
                        required
                        style="
                            width: 100%;
                            padding: 15px;
                            margin-bottom: 25px;
                            font-size: 1.1em;
                            background: rgba(0, 0, 0, 0.3);
                            border: 2px solid rgba(212, 175, 55, 0.3);
                            border-radius: 10px;
                            color: white;
                        "
                        onfocus="this.style.borderColor='#d4af37'"
                        onblur="this.style.borderColor='rgba(212, 175, 55, 0.3)'"
                    >
                    
                    <button 
                        type="submit"
                        style="
                            width: 100%;
                            background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                            color: #1e1e1e;
                            border: none;
                            padding: 18px 50px;
                            border-radius: 12px;
                            font-size: 1.3em;
                            font-weight: 700;
                            cursor: pointer;
                            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.5);
                            transition: all 0.3s ease;
                        "
                        onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 15px 40px rgba(212, 175, 55, 0.7)';"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(212, 175, 55, 0.5)';"
                    >
                        üöÄ QUERO MEU DIAGN√ìSTICO!
                    </button>
                </form>
                
                <div style="color: #888; font-size: 0.85em; line-height: 1.5;">
                    üîí Seus dados est√£o seguros. N√£o enviamos spam.
                </div>
            </div>
        </div>
    </div>
    <script>
        // ============================================
        // FUN√á√ÉO DE TRACKING DE CLIQUES EM CTAs
        // ============================================
        function trackCTAClick(ctaName) {
            console.log('üîî trackCTAClick CHAMADA! Nome:', ctaName);
            
            const urlParams = new URLSearchParams(window.location.search);
            
            const trackingData = {
                cta_clicado: ctaName,
                data_clique: new Date().toLocaleString('pt-BR'),
                screen: window.screen.width + '√ó' + window.screen.height,
                device_type: /Mobile|Android|iPhone|iPad/i.test(navigator.userAgent) ? 'mobile' : 'desktop',
                browser: (navigator.userAgent.match(/(Firefox|Chrome|Safari|Edge|Opera)/) || ['Other'])[0],
                utm_source: urlParams.get('utm_source') || '',
                utm_medium: urlParams.get('utm_medium') || '',
                utm_campaign: urlParams.get('utm_campaign') || '',
                utm_content: urlParams.get('utm_content') || '',
                utm_term: urlParams.get('utm_term') || ''
            };
            
            console.log('üíæ Salvando no localStorage:', trackingData);
            localStorage.setItem('cta_tracking', JSON.stringify(trackingData));
            
            // Verificar se salvou
            const saved = localStorage.getItem('cta_tracking');
            console.log('‚úÖ Confirma√ß√£o - localStorage agora tem:', saved);
            
            console.log('üéØ CTA Clicado:', ctaName);
            console.log('üìä Tracking Data:', trackingData);
            
            // Meta Pixel
            if (typeof fbq !== 'undefined') {
                fbq('track', 'InitiateCheckout', {
                    content_name: ctaName,
                    value: ctaName.includes('Mapa') ? 29.90 : 37.00,
                    currency: 'BRL'
                });
            }
        }
        
        // Fun√ß√£o trackEvent (para eventos gen√©ricos)
        function trackEvent(eventName, eventData = {}) {
            console.log('üìä trackEvent:', eventName, eventData);
            
            // Track via localStorage (similar ao trackCTAClick)
            const trackingData = {
                event: eventName,
                data: eventData,
                timestamp: new Date().toLocaleString('pt-BR'),
                screen: window.screen.width + '√ó' + window.screen.height,
                device_type: /Mobile|Android|iPhone|iPad/i.test(navigator.userAgent) ? 'mobile' : 'desktop'
            };
            
            // Meta Pixel (se dispon√≠vel)
            if (typeof fbq !== 'undefined') {
                fbq('trackCustom', eventName, eventData);
            }
            
            console.log('‚úÖ Evento trackado:', eventName);
        }
        
        // Testar se a fun√ß√£o foi carregada
        console.log('‚úÖ Fun√ß√£o trackCTAClick carregada e dispon√≠vel!');
        console.log('üß™ Teste: window.trackCTAClick =', typeof window.trackCTAClick);
        
        // ============================================
        // SISTEMA DE ORDEM DE CLIQUE DAS FAM√çLIAS
        // ============================================
        
        // Array para guardar ordem de clique
        let familiaClickOrder = [];
        
        // Adicionar event listeners aos checkboxes
        document.addEventListener('DOMContentLoaded', function() {
            const checkboxes = document.querySelectorAll('.familia-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const familiaKey = this.dataset.familia;
                    
                    if (this.checked) {
                        // Adiciona na ordem de clique
                        if (!familiaClickOrder.includes(familiaKey)) {
                            familiaClickOrder.push(familiaKey);
                        }
                    } else {
                        // Remove da lista
                        familiaClickOrder = familiaClickOrder.filter(f => f !== familiaKey);
                    }
                    
                    console.log('üìã Ordem de clique atual:', familiaClickOrder);
                });
            });
        });
        
        // Fun√ß√£o para pegar checkboxes na ordem de clique
        function getCheckboxesInClickOrder() {
            const allCheckboxes = document.querySelectorAll('.familia-checkbox:checked');
            const checkboxesArray = Array.from(allCheckboxes);
            
            // Ordenar pelo √≠ndice em familiaClickOrder
            return checkboxesArray.sort((a, b) => {
                const indexA = familiaClickOrder.indexOf(a.dataset.familia);
                const indexB = familiaClickOrder.indexOf(b.dataset.familia);
                return indexA - indexB;
            });
        }
        
        // ============================================
// ============================================
// SISTEMA DE RECOMENDA√á√ïES DE PERFUMES
// ============================================

// ============================================
// BASE DE DADOS ATUALIZADA - 90 PERFUMES (2015-2025)
// 10 perfumes por fam√≠lia
// ============================================

const PERFUMES_DATABASE = [
    // ========== C√çTRICO (10) ==========
    {familia:"C√≠trico",nome:"Versace Pour Homme Dylan Blue",marca:"Versace",notas:"Bergamota, Toranja, Pimenta",clima:"temperado",ambiente:"ambos",preco:"400-500",nivel:"iniciante",desc:"C√≠trico arom√°tico moderno e vers√°til",ano:2016},
    {familia:"C√≠trico",nome:"Prada L'Homme",marca:"Prada",notas:"N√©roli, Ger√¢nio, √Çmbar",clima:"temperado",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"C√≠trico talcado elegante e sofisticado",ano:2016},
    {familia:"C√≠trico",nome:"Dolce & Gabbana Light Blue Eau Intense",marca:"Dolce & Gabbana",notas:"Toranja, Jun√≠pero, Alm√≠scar",clima:"quente",ambiente:"aberto",preco:"400-500",nivel:"iniciante",desc:"C√≠trico aqu√°tico intenso para o ver√£o",ano:2017},
    {familia:"C√≠trico",nome:"YSL Y Eau de Toilette",marca:"Yves Saint Laurent",notas:"Bergamota, Gengibre, S√°lvia",clima:"temperado",ambiente:"ambos",preco:"450-550",nivel:"iniciante",desc:"C√≠trico fresco jovem e energ√©tico",ano:2017},
    {familia:"C√≠trico",nome:"Versace Eros Flame",marca:"Versace",notas:"Lim√£o, Tangerina, Pimenta",clima:"temperado",ambiente:"ambos",preco:"450-550",nivel:"intermediario",desc:"C√≠trico especiado vibrante",ano:2018},
    {familia:"C√≠trico",nome:"Montblanc Explorer",marca:"Montblanc",notas:"Bergamota, S√°lvia, Vetiver",clima:"temperado",ambiente:"ambos",preco:"350-450",nivel:"iniciante",desc:"C√≠trico amadeirado vers√°til e acess√≠vel",ano:2019},
    {familia:"C√≠trico",nome:"Givenchy Gentleman Reserve Priv√©e",marca:"Givenchy",notas:"Whisky, Bergamota, Iris",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"C√≠trico arom√°tico com twist alco√≥lico",ano:2019},
    {familia:"C√≠trico",nome:"Acqua di Gio Profondo",marca:"Giorgio Armani",notas:"Bergamota, Alecrim Marinho, Alm√≠scar",clima:"quente",ambiente:"aberto",preco:"450-550",nivel:"iniciante",desc:"C√≠trico aqu√°tico profundo e refrescante",ano:2020},
    {familia:"C√≠trico",nome:"Paco Rabanne Phantom",marca:"Paco Rabanne",notas:"Lim√£o, Lavanda, Baunilha",clima:"temperado",ambiente:"ambos",preco:"450-550",nivel:"iniciante",desc:"C√≠trico arom√°tico futurista",ano:2021},
    {familia:"C√≠trico",nome:"Boss Bottled Elixir",marca:"Hugo Boss",notas:"Cardamomo, Cedro, Vetiver",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"C√≠trico especiado intenso e moderno",ano:2023},

    // ========== AMADEIRADO (10) ==========
    {familia:"Amadeirado",nome:"Dior Sauvage Elixir",marca:"Dior",notas:"Canela, Noz-moscada, Lavanda",clima:"frio",ambiente:"fechado",preco:"700-800",nivel:"avancado",desc:"Amadeirado especiado ultra concentrado",ano:2021},
    {familia:"Amadeirado",nome:"Bleu de Chanel Parfum",marca:"Chanel",notas:"S√¢ndalo, Cedro, Alm√≠scar",clima:"frio",ambiente:"fechado",preco:"700-900",nivel:"avancado",desc:"Amadeirado arom√°tico premium intenso",ano:2018},
    {familia:"Amadeirado",nome:"YSL Y Eau de Parfum",marca:"Yves Saint Laurent",notas:"Ma√ß√£, Ger√¢nio, Cedro",clima:"temperado",ambiente:"ambos",preco:"500-600",nivel:"intermediario",desc:"Amadeirado frutado moderno",ano:2018},
    {familia:"Amadeirado",nome:"Prada Luna Rossa Black",marca:"Prada",notas:"Ang√©lica, √Çmbar, Patchouli",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Amadeirado oriental sofisticado",ano:2017},
    {familia:"Amadeirado",nome:"Giorgio Armani Code Absolu",marca:"Giorgio Armani",notas:"Ma√ß√£ Verde, Mandarim, Tonka",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Amadeirado oriental sedutor intenso",ano:2019},
    {familia:"Amadeirado",nome:"Carolina Herrera Bad Boy",marca:"Carolina Herrera",notas:"Pimenta, Cedro, Cacau",clima:"frio",ambiente:"ambos",preco:"450-550",nivel:"intermediario",desc:"Amadeirado especiado jovem e ousado",ano:2019},
    {familia:"Amadeirado",nome:"Versace Dylan Blue Pour Homme",marca:"Versace",notas:"Cedro, Patchouli, Alm√≠scar",clima:"temperado",ambiente:"ambos",preco:"400-500",nivel:"iniciante",desc:"Amadeirado foug√®re moderno",ano:2016},
    {familia:"Amadeirado",nome:"Azzaro The Most Wanted",marca:"Azzaro",notas:"Cardamomo, Toffee, √Çmbar",clima:"frio",ambiente:"fechado",preco:"400-500",nivel:"intermediario",desc:"Amadeirado gourmand intenso",ano:2021},
    {familia:"Amadeirado",nome:"Ralph Lauren Polo Red Extreme",marca:"Ralph Lauren",notas:"Cranberry, Caf√©, Cedro",clima:"frio",ambiente:"ambos",preco:"350-450",nivel:"iniciante",desc:"Amadeirado especiado energ√©tico",ano:2015},
    {familia:"Amadeirado",nome:"Givenchy Gentleman Eau de Parfum Bois√©e",marca:"Givenchy",notas:"Cedro, S√¢ndalo, Iris",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Amadeirado arom√°tico elegante",ano:2020},

    // ========== ORIENTAL (10) ==========
    {familia:"Oriental",nome:"YSL La Nuit de L'Homme Bleu √âlectrique",marca:"Yves Saint Laurent",notas:"Cardamomo, Ger√¢nio, Cedro",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Oriental especiado el√©trico e sedutor",ano:2021},
    {familia:"Oriental",nome:"Paco Rabanne 1 Million Parfum",marca:"Paco Rabanne",notas:"Damasco, Especiarias, Couro",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Oriental especiado rico e opulento",ano:2020},
    {familia:"Oriental",nome:"Dolce & Gabbana The One Eau de Parfum",marca:"Dolce & Gabbana",notas:"Coentro, Gengibre, Tabaco",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Oriental especiado elegante intenso",ano:2015},
    {familia:"Oriental",nome:"Valentino Uomo Intense",marca:"Valentino",notas:"Iris, Tonka, Baunilha",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Oriental talcado sofisticado intenso",ano:2016},
    {familia:"Oriental",nome:"Paco Rabanne Pure XS",marca:"Paco Rabanne",notas:"Gengibre, Canela, Baunilha",clima:"frio",ambiente:"fechado",preco:"450-550",nivel:"intermediario",desc:"Oriental especiado sensual e intenso",ano:2017},
    {familia:"Oriental",nome:"Jean Paul Gaultier Ultra Male",marca:"Jean Paul Gaultier",notas:"Pera, Canela, Baunilha",clima:"frio",ambiente:"fechado",preco:"450-550",nivel:"intermediario",desc:"Oriental frutado doce e sedutor",ano:2015},
    {familia:"Oriental",nome:"Azzaro Wanted by Night",marca:"Azzaro",notas:"Canela, Tabaco, √Çmbar",clima:"frio",ambiente:"fechado",preco:"400-500",nivel:"intermediario",desc:"Oriental especiado noturno intenso",ano:2018},
    {familia:"Oriental",nome:"Carolina Herrera Bad Boy Cobalt",marca:"Carolina Herrera",notas:"Trufas, Gengibre, Cedro",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Oriental gourmand el√©trico",ano:2021},
    {familia:"Oriental",nome:"Emporio Armani Stronger With You Intensely",marca:"Giorgio Armani",notas:"Canela, Baunilha, √Çmbar",clima:"frio",ambiente:"fechado",preco:"450-550",nivel:"intermediario",desc:"Oriental especiado quente e envolvente",ano:2019},
    {familia:"Oriental",nome:"Montblanc Legend Spirit",marca:"Montblanc",notas:"Cardamomo, Lavanda, Alm√≠scar",clima:"temperado",ambiente:"ambos",preco:"350-450",nivel:"iniciante",desc:"Oriental arom√°tico fresco e moderno",ano:2016},

    // ========== FLORAL (10) ==========
    {familia:"Floral",nome:"Dior Homme Intense",marca:"Dior",notas:"Iris, Lavanda, Pera",clima:"frio",ambiente:"fechado",preco:"600-700",nivel:"intermediario",desc:"Floral talcado luxuoso e sofisticado",ano:2020},
    {familia:"Floral",nome:"Prada L'Homme Intense",marca:"Prada",notas:"Iris, √Çmbar, Patchouli",clima:"frio",ambiente:"fechado",preco:"550-650",nivel:"intermediario",desc:"Floral talcado intenso e elegante",ano:2017},
    {familia:"Floral",nome:"Valentino Uomo Born in Roma",marca:"Valentino",notas:"Gengibre, S√°lvia, Vetiver",clima:"temperado",ambiente:"ambos",preco:"500-600",nivel:"intermediario",desc:"Floral arom√°tico moderno e vibrante",ano:2019},
    {familia:"Floral",nome:"Burberry Mr. Burberry Indigo",marca:"Burberry",notas:"Ger√¢nio, S√°lvia, √Çmbar",clima:"temperado",ambiente:"aberto",preco:"450-550",nivel:"iniciante",desc:"Floral arom√°tico fresco e clean",ano:2018},
    {familia:"Floral",nome:"Boss Bottled Infinite",marca:"Hugo Boss",notas:"Manjeric√£o, S√°lvia, Cedro",clima:"temperado",ambiente:"ambos",preco:"400-500",nivel:"iniciante",desc:"Floral arom√°tico vers√°til e moderno",ano:2019},
    {familia:"Floral",nome:"Givenchy Gentleman Cologne",marca:"Givenchy",notas:"Lim√£o, Iris, Musgo",clima:"temperado",ambiente:"aberto",preco:"450-550",nivel:"iniciante",desc:"Floral c√≠trico fresco e elegante",ano:2019},
    {familia:"Floral",nome:"Versace Pour Homme",marca:"Versace",notas:"Lim√£o, N√©roli, Cedro",clima:"temperado",ambiente:"aberto",preco:"350-450",nivel:"iniciante",desc:"Floral c√≠trico cl√°ssico renovado",ano:2023},
    {familia:"Floral",nome:"Issey Miyake L'Eau d'Issey Pour Homme",marca:"Issey Miyake",notas:"Yuzu, Noz-moscada, S√¢ndalo",clima:"temperado",ambiente:"aberto",preco:"350-450",nivel:"iniciante",desc:"Floral aqu√°tico clean e minimalista",ano:2015},
    {familia:"Floral",nome:"Herm√®s Terre d'Herm√®s Eau Intense V√©tiver",marca:"Herm√®s",notas:"Bergamota, Vetiver, Ger√¢nio",clima:"temperado",ambiente:"ambos",preco:"600-700",nivel:"avancado",desc:"Floral amadeirado luxuoso intenso",ano:2018},
    {familia:"Floral",nome:"Calvin Klein Eternity Intense",marca:"Calvin Klein",notas:"Ger√¢nio, Lavanda, Vetiver",clima:"temperado",ambiente:"ambos",preco:"350-450",nivel:"iniciante",desc:"Floral arom√°tico atemporal intenso",ano:2019},

    // ========== AQU√ÅTICO (10) ==========
    {familia:"Aqu√°tico",nome:"Davidoff Cool Water Intense",marca:"Davidoff",notas:"Menta, Coco, √Çmbar",clima:"quente",ambiente:"aberto",preco:"250-350",nivel:"iniciante",desc:"Aqu√°tico intenso refrescante e acess√≠vel",ano:2019},
    {familia:"Aqu√°tico",nome:"Bvlgari Aqva Pour Homme Atlantiqve",marca:"Bvlgari",notas:"Calabresa, S√¢ndalo, Patchouli",clima:"temperado",ambiente:"aberto",preco:"450-550",nivel:"intermediario",desc:"Aqu√°tico amadeirado marinho sofisticado",ano:2017},
    {familia:"Aqu√°tico",nome:"Giorgio Armani Acqua di Gi√≤ Profumo",marca:"Giorgio Armani",notas:"Bergamota, Ger√¢nio, Incenso",clima:"temperado",ambiente:"ambos",preco:"500-600",nivel:"intermediario",desc:"Aqu√°tico arom√°tico intenso e elegante",ano:2015},
    {familia:"Aqu√°tico",nome:"Issey Miyake Nuit d'Issey",marca:"Issey Miyake",notas:"Bergamota, Especiarias, Patchouli",clima:"frio",ambiente:"fechado",preco:"400-500",nivel:"intermediario",desc:"Aqu√°tico amadeirado noturno",ano:2015},
    {familia:"Aqu√°tico",nome:"Lacoste L'Homme Intense",marca:"Lacoste",notas:"Toranja, √Çmbar, Cedro",clima:"temperado",ambiente:"aberto",preco:"300-400",nivel:"iniciante",desc:"Aqu√°tico amadeirado esportivo intenso",ano:2017},
    {familia:"Aqu√°tico",nome:"Nautica Voyage N-83",marca:"Nautica",notas:"Lim√£o, S√°lvia, √Çmbar",clima:"quente",ambiente:"aberto",preco:"150-250",nivel:"iniciante",desc:"Aqu√°tico arom√°tico acess√≠vel e vers√°til",ano:2015},
    {familia:"Aqu√°tico",nome:"Azzaro Chrome Aqua",marca:"Azzaro",notas:"Toranja, Especiarias, Vetiver",clima:"quente",ambiente:"aberto",preco:"300-400",nivel:"iniciante",desc:"Aqu√°tico especiado refrescante",ano:2017},
    {familia:"Aqu√°tico",nome:"Perry Ellis Aqua Extreme",marca:"Perry Ellis",notas:"Bergamota, Pepino, √Çmbar",clima:"quente",ambiente:"aberto",preco:"150-250",nivel:"iniciante",desc:"Aqu√°tico fresco extremo e acess√≠vel",ano:2019},
    {familia:"Aqu√°tico",nome:"Salvatore Ferragamo Acqua Essenziale Blu",marca:"Salvatore Ferragamo",notas:"Cardamomo, Cipreste, Patchouli",clima:"temperado",ambiente:"aberto",preco:"350-450",nivel:"iniciante",desc:"Aqu√°tico amadeirado elegante",ano:2015},
    {familia:"Aqu√°tico",nome:"Givenchy Gentleman Only Absolute",marca:"Givenchy",notas:"Coco, Mirra, Patchouli",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Aqu√°tico amadeirado luxuoso intenso",ano:2015},

    // ========== FOUG√àRE (9) ==========
    {familia:"Foug√®re",nome:"Giorgio Armani Acqua di Gi√≤ Absolu",marca:"Giorgio Armani",notas:"Bergamota, Ger√¢nio, Patchouli",clima:"temperado",ambiente:"ambos",preco:"500-600",nivel:"intermediario",desc:"Foug√®re arom√°tico absoluto e intenso",ano:2018},
    {familia:"Foug√®re",nome:"YSL Y Le Parfum",marca:"Yves Saint Laurent",notas:"Ma√ß√£, Lavanda, Cedro",clima:"frio",ambiente:"fechado",preco:"550-650",nivel:"intermediario",desc:"Foug√®re amadeirado intenso e moderno",ano:2021},
    {familia:"Foug√®re",nome:"Azzaro Wanted",marca:"Azzaro",notas:"Lim√£o, Menta, Tonka",clima:"temperado",ambiente:"ambos",preco:"400-500",nivel:"iniciante",desc:"Foug√®re especiado vibrante e sedutor",ano:2016},
    {familia:"Foug√®re",nome:"Montblanc Legend",marca:"Montblanc",notas:"Bergamota, Lavanda, Tonka",clima:"temperado",ambiente:"ambos",preco:"350-450",nivel:"iniciante",desc:"Foug√®re arom√°tico vers√°til e acess√≠vel",ano:2015},
    {familia:"Foug√®re",nome:"Ralph Lauren Polo Blue Eau de Parfum",marca:"Ralph Lauren",notas:"Mel√£o, Manjeric√£o, Alm√≠scar",clima:"temperado",ambiente:"aberto",preco:"400-500",nivel:"iniciante",desc:"Foug√®re aqu√°tico fresco intenso",ano:2016},
    {familia:"Foug√®re",nome:"Burberry Touch for Men",marca:"Burberry",notas:"Artem√≠sia, Cedro, Musgo Branco",clima:"temperado",ambiente:"ambos",preco:"350-450",nivel:"iniciante",desc:"Foug√®re amadeirado clean e elegante",ano:2015},
    {familia:"Foug√®re",nome:"Lanc√¥me L'Homme Id√©al",marca:"Lanc√¥me",notas:"Am√™ndoa, Couro, Tonka",clima:"frio",ambiente:"fechado",preco:"450-550",nivel:"intermediario",desc:"Foug√®re gourmand sofisticado",ano:2015},
    {familia:"Foug√®re",nome:"Guess Seductive Homme",marca:"Guess",notas:"Cardamomo, Vetiver, √Çmbar",clima:"temperado",ambiente:"ambos",preco:"250-350",nivel:"iniciante",desc:"Foug√®re especiado sedutor acess√≠vel",ano:2015},
    {familia:"Foug√®re",nome:"Kenneth Cole Mankind Hero",marca:"Kenneth Cole",notas:"Gengibre, Castanha, Baunilha",clima:"frio",ambiente:"fechado",preco:"200-300",nivel:"iniciante",desc:"Foug√®re especiado heroico e acess√≠vel",ano:2019},

    // ========== ESPECIADO (10) ==========
    {familia:"Especiado",nome:"Viktor & Rolf Spicebomb Extreme",marca:"Viktor & Rolf",notas:"Canela, Tabaco, Baunilha",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"avancado",desc:"Especiado explosivo ultra intenso",ano:2015},
    {familia:"Especiado",nome:"Dior Fahrenheit Parfum",marca:"Dior",notas:"Violeta, Couro, Baunilha",clima:"frio",ambiente:"fechado",preco:"600-700",nivel:"avancado",desc:"Especiado couro luxuoso intenso",ano:2015},
    {familia:"Especiado",nome:"Yves Saint Laurent L'Homme Ultime",marca:"Yves Saint Laurent",notas:"Bergamota, Cardamomo, Cedro",clima:"temperado",ambiente:"ambos",preco:"500-600",nivel:"intermediario",desc:"Especiado arom√°tico definitivo",ano:2016},
    {familia:"Especiado",nome:"Paco Rabanne 1 Million Priv√©",marca:"Paco Rabanne",notas:"Laranja Sangu√≠nea, Mirra, Tonka",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Especiado privado luxuoso e intenso",ano:2016},
    {familia:"Especiado",nome:"Carolina Herrera Bad Boy Le Parfum",marca:"Carolina Herrera",notas:"Bergamota, Pimenta, Cacau",clima:"frio",ambiente:"fechado",preco:"550-650",nivel:"intermediario",desc:"Especiado intenso ousado e moderno",ano:2022},
    {familia:"Especiado",nome:"Givenchy Pi Neo",marca:"Givenchy",notas:"Bergamota, Anis, Patchouli",clima:"temperado",ambiente:"ambos",preco:"400-500",nivel:"intermediario",desc:"Especiado arom√°tico futurista",ano:2015},
    {familia:"Especiado",nome:"Boss Bottled Oud",marca:"Hugo Boss",notas:"Cidra, Canela, Oud",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"avancado",desc:"Especiado oriental com oud",ano:2015},
    {familia:"Especiado",nome:"Armaf Club de Nuit Intense Man",marca:"Armaf",notas:"Lim√£o, Pimenta Rosa, √Çmbar",clima:"frio",ambiente:"fechado",preco:"150-250",nivel:"iniciante",desc:"Especiado intenso acess√≠vel e potente",ano:2015},
    {familia:"Especiado",nome:"Azzaro Most Wanted Parfum",marca:"Azzaro",notas:"Cardamomo, Bourbon, √Çmbar",clima:"frio",ambiente:"fechado",preco:"450-550",nivel:"intermediario",desc:"Especiado gourmand mais procurado",ano:2022},
    {familia:"Especiado",nome:"John Varvatos Artisan Acqua",marca:"John Varvatos",notas:"Charneca, Lavanda, Laranja",clima:"temperado",ambiente:"aberto",preco:"350-450",nivel:"intermediario",desc:"Especiado arom√°tico artesanal aqu√°tico",ano:2015},

    // ========== COURO (10) ==========
    {familia:"Couro",nome:"Dior Fahrenheit Le Parfum",marca:"Dior",notas:"Violeta, Couro Suede, Baunilha",clima:"frio",ambiente:"fechado",preco:"650-750",nivel:"avancado",desc:"Couro violeta luxuoso e ic√¥nico",ano:2015},
    {familia:"Couro",nome:"Herm√®s Terre d'Herm√®s Parfum",marca:"Herm√®s",notas:"Toranja, S√≠lex, Cedro",clima:"temperado",ambiente:"fechado",preco:"700-800",nivel:"avancado",desc:"Couro mineral terroso e sofisticado",ano:2015},
    {familia:"Couro",nome:"Gucci Guilty Absolute Pour Homme",marca:"Gucci",notas:"Couro, Cipreste, Patchouli",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"avancado",desc:"Couro absoluto intenso e ousado",ano:2017},
    {familia:"Couro",nome:"Tom Ford Ombr√© Leather",marca:"Tom Ford",notas:"Cardamomo, Couro, Patchouli",clima:"frio",ambiente:"fechado",preco:"800-1000",nivel:"avancado",desc:"Couro sensual luxuoso premium",ano:2018},
    {familia:"Couro",nome:"Bentley for Men Intense",marca:"Bentley",notas:"Rum, Couro, √Çmbar",clima:"frio",ambiente:"fechado",preco:"300-400",nivel:"intermediario",desc:"Couro alco√≥lico intenso e potente",ano:2015},
    {familia:"Couro",nome:"Dunhill Icon Absolute",marca:"Dunhill",notas:"Bergamota, Couro, Oud",clima:"frio",ambiente:"fechado",preco:"400-500",nivel:"avancado",desc:"Couro oud absoluto elegante",ano:2017},
    {familia:"Couro",nome:"Montblanc Legend Night",marca:"Montblanc",notas:"Bergamota, Couro, Cedro",clima:"frio",ambiente:"fechado",preco:"350-450",nivel:"intermediario",desc:"Couro noturno arom√°tico moderno",ano:2017},
    {familia:"Couro",nome:"Jaguar Classic Black",marca:"Jaguar",notas:"Ma√ß√£, Couro, Tonka",clima:"frio",ambiente:"fechado",preco:"150-250",nivel:"iniciante",desc:"Couro cl√°ssico acess√≠vel e potente",ano:2015},
    {familia:"Couro",nome:"Azzaro Wanted by Night",marca:"Azzaro",notas:"Canela, Couro, Tabaco",clima:"frio",ambiente:"fechado",preco:"400-500",nivel:"intermediario",desc:"Couro especiado noturno sedutor",ano:2018},
    {familia:"Couro",nome:"Zadig & Voltaire This is Him!",marca:"Zadig & Voltaire",notas:"Toranja, Incenso, Baunilha",clima:"frio",ambiente:"fechado",preco:"350-450",nivel:"intermediario",desc:"Couro incensado rock e moderno",ano:2016},

    // ========== GOURMAND (10) ==========
    {familia:"Gourmand",nome:"Paco Rabanne Invictus Legend",marca:"Paco Rabanne",notas:"Laranja Sangu√≠nea, Louro, √Çmbar",clima:"frio",ambiente:"fechado",preco:"450-550",nivel:"intermediario",desc:"Gourmand especiado lend√°rio",ano:2019},
    {familia:"Gourmand",nome:"Jean Paul Gaultier Le Male Le Parfum",marca:"Jean Paul Gaultier",notas:"Cardamomo, Iris, Baunilha",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Gourmand oriental intenso e sedutor",ano:2020},
    {familia:"Gourmand",nome:"Mugler A*Men Kryptomint",marca:"Mugler",notas:"Menta, Caf√©, Cacau",clima:"temperado",ambiente:"ambos",preco:"400-500",nivel:"avancado",desc:"Gourmand mentolado cripto intenso",ano:2018},
    {familia:"Gourmand",nome:"Azzaro Wanted Tonic",marca:"Azzaro",notas:"Toranja, Gengibre, √Çmbar",clima:"quente",ambiente:"aberto",preco:"400-500",nivel:"iniciante",desc:"Gourmand t√¥nico refrescante vibrante",ano:2021},
    {familia:"Gourmand",nome:"Dolce & Gabbana The One Royal Night",marca:"Dolce & Gabbana",notas:"Cardamomo, Damasco, Tabaco",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Gourmand real noturno luxuoso",ano:2015},
    {familia:"Gourmand",nome:"Givenchy Pi",marca:"Givenchy",notas:"Baunilha, √Çmbar, Benzoin",clima:"frio",ambiente:"fechado",preco:"400-500",nivel:"intermediario",desc:"Gourmand matem√°tico envolvente",ano:2015},
    {familia:"Gourmand",nome:"Prada Candy Night",marca:"Prada",notas:"Laranja Amarga, Chocolate, Tonka",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Gourmand noturno achocolatado intenso",ano:2019},
    {familia:"Gourmand",nome:"Valentino Uomo Noir Absolu",marca:"Valentino",notas:"Bergamota, Caf√©, Baunilha",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Gourmand caf√© absoluto sofisticado",ano:2018},
    {familia:"Gourmand",nome:"Armani Code Profumo",marca:"Giorgio Armani",notas:"Cardamomo, √Çmbar, Tonka",clima:"frio",ambiente:"fechado",preco:"500-600",nivel:"intermediario",desc:"Gourmand oriental profundo intenso",ano:2016},
    {familia:"Gourmand",nome:"Carolina Herrera Bad Boy Cobalt Elixir",marca:"Carolina Herrera",notas:"Pluma, Caf√©, Cedro",clima:"frio",ambiente:"fechado",preco:"550-650",nivel:"intermediario",desc:"Gourmand elixir cobalto ultra intenso",ano:2023}
];
// Calcular score de match
function calculatePerfumeScore(perfume, userProfile) {
    let score = 0;
    
    // 1. Fam√≠lia olfativa (peso 40% com prioridade)
    const familiaIndex = userProfile.familias.indexOf(perfume.familia);
    if (familiaIndex !== -1) {
        // Fam√≠lia encontrada! Dar mais pontos para fam√≠lias priorit√°rias
        if (familiaIndex === 0) {
            score += 40; // Prioridade 1
        } else if (familiaIndex === 1) {
            score += 30; // Prioridade 2
        } else if (familiaIndex === 2) {
            score += 20; // Prioridade 3
        } else {
            score += 10; // Outras fam√≠lias
        }
    }
    
    // 2. Clima (peso 30%)
    const climaMatch = {
        'quente': ['quente', 'temperado'],
        'temperado': ['temperado', 'quente', 'frio'],
        'frio': ['frio', 'temperado']
    };
    
    if (climaMatch[userProfile.clima] && climaMatch[userProfile.clima].includes(perfume.clima)) {
        score += 30;
    }
    
    // 3. Ambiente (peso 20%)
    if (perfume.ambiente === 'ambos' || perfume.ambiente === userProfile.ambiente) {
        score += 20;
    }
    
    // 4. N√≠vel (peso 10%)
    if (perfume.nivel === userProfile.nivel) {
        score += 10;
    }
    
    return score;
}

// Obter top 3 recomenda√ß√µes
function getTop3Recommendations(userProfile) {
    console.log('üîç Iniciando busca de recomenda√ß√µes...');
    console.log('üë§ Perfil do usu√°rio:', userProfile);
    
    // Calcular score para cada perfume
    const scored = PERFUMES_DATABASE.map(perfume => {
        const perfumeScore = calculatePerfumeScore(perfume, userProfile);
        return {
            ...perfume,
            score: perfumeScore
        };
    });
    
    // ============================================
    // RANDOMIZAR PERFUMES COM MESMO SCORE
    // ============================================
    // Agrupar por score
    const scoreGroups = {};
    scored.forEach(p => {
        if (!scoreGroups[p.score]) {
            scoreGroups[p.score] = [];
        }
        scoreGroups[p.score].push(p);
    });
    
    // Embaralhar cada grupo
    Object.keys(scoreGroups).forEach(score => {
        const group = scoreGroups[score];
        // Fisher-Yates shuffle
        for (let i = group.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [group[i], group[j]] = [group[j], group[i]];
        }
    });
    
    // Reconstruir array ordenado com grupos embaralhados
    const shuffledScored = Object.keys(scoreGroups)
        .map(Number)
        .sort((a, b) => b - a)
        .flatMap(score => scoreGroups[score]);
    
    console.log('üé≤ Perfumes randomizados por score igual');
    
    console.log('üèÜ Top 10 perfumes por score:', shuffledScored.slice(0, 10).map(p => ({
        nome: p.nome,
        familia: p.familia,
        score: p.score,
        clima: p.clima,
        ambiente: p.ambiente
    })));
    
    // ============================================
    // GARANTIR QUE #1 SEJA DA FAM√çLIA PRIORIT√ÅRIA (P1)
    // ============================================
    
    const familiaPrioritaria = userProfile.familias[0]; // P1
    
    console.log('üéØ Fam√≠lia priorit√°ria (P1):', familiaPrioritaria);
    
    // Filtrar apenas perfumes da fam√≠lia P1
    const perfumesDaP1 = shuffledScored.filter(p => p.familia === familiaPrioritaria);
    
    console.log(`‚úÖ Encontrados ${perfumesDaP1.length} perfumes da fam√≠lia ${familiaPrioritaria}`);
    
    if (perfumesDaP1.length === 0) {
        console.warn('‚ö†Ô∏è ATEN√á√ÉO: Nenhum perfume encontrado da fam√≠lia P1! Usando ranking geral.');
        // Fallback: usar ranking geral se n√£o houver perfumes da P1
        const top3 = shuffledScored.slice(0, 3);
        console.log('‚úÖ Top 3 selecionados (fallback):', top3.map(p => `${p.nome} (${p.score} pts)`));
        return top3;
    }
    
    // #1 = Melhor perfume da fam√≠lia P1
    const primeiro = perfumesDaP1[0];
    
    console.log(`üèÜ #1 GARANTIDO da P1: ${primeiro.nome} (${primeiro.familia}) - ${primeiro.score} pts`);
    
    // Para #2 e #3, pegar do ranking geral (mas excluir o #1)
    const remaining = shuffledScored.filter(p => p.nome !== primeiro.nome);
    const segundo = remaining[0];
    const terceiro = remaining[1];
    
    const top3 = [primeiro, segundo, terceiro];
    
    console.log('‚úÖ Top 3 selecionados:', top3.map(p => `${p.nome} (${p.familia}) - ${p.score} pts`));
    
    return top3;
}

// Gerar HTML do card de perfume
function generatePerfumeCard(perfume, position, isBlurred) {
    const positionColors = {
        1: { color: '#ff6b6b', label: 'üèÜ SUA MELHOR ESCOLHA' },
        2: { color: '#4ecdc4', label: 'ü•à SEGUNDA OP√á√ÉO' },
        3: { color: '#95e1d3', label: 'ü•â TERCEIRA OP√á√ÉO' }
    };
    
    const posConfig = positionColors[position];
    
    if (isBlurred) {
        return `
            <div style="
                filter: blur(8px);
                user-select: none;
                pointer-events: none;
                opacity: 0.6;
            ">
                <div style="color: ${posConfig.color}; font-size: 0.85em; font-weight: 700; margin-bottom: 8px;">
                    ${posConfig.label}
                </div>
                <div style="color: #fff; font-size: 1.1em; font-weight: 600; margin-bottom: 8px;">
                    ${perfume.nome}
                </div>
                <div style="color: #ccc; font-size: 0.9em; margin-bottom: 8px;">
                    ${perfume.marca}
                </div>
                <div style="color: #aaa; font-size: 0.85em; margin-bottom: 5px;">
                    üéµ ${perfume.notas}
                </div>
                <div style="color: #888; font-size: 0.8em;">
                    üí∞ R$ ${perfume.preco}
                </div>
            </div>
        `;
    }
    
    return `
        <div style="margin-bottom: 20px;">
            <div style="color: ${posConfig.color}; font-size: 0.85em; font-weight: 700; margin-bottom: 8px;">
                ${posConfig.label}
            </div>
            <div style="color: #fff; font-size: 1.1em; font-weight: 600; margin-bottom: 8px;">
                ${perfume.nome}
            </div>
            <div style="color: #ccc; font-size: 0.9em; margin-bottom: 8px;">
                ${perfume.marca}
            </div>
            <div style="color: #aaa; font-size: 0.85em; margin-bottom: 5px; line-height: 1.4;">
                üéµ ${perfume.notas}
            </div>
            <div style="color: #888; font-size: 0.8em; margin-bottom: 5px;">
                üí∞ R$ ${perfume.preco}
            </div>
            <div style="color: #999; font-size: 0.8em; line-height: 1.4; font-style: italic;">
                ${perfume.desc}
            </div>
        </div>
    `;
}

// Mapeamento entre fam√≠lias do diagn√≥stico e banco de dados
const FAMILIA_MAPPING = {
    'fresco': 'C√≠trico',
    'aromatico': 'Foug√®re',
    'doce': 'Gourmand',
    'amadeirado': 'Amadeirado',
    'especiado': 'Especiado',
    'aquatico': 'Aqu√°tico',
    'talco': 'Foug√®re',
    'floral': 'Floral',
    'frutas': 'Oriental'
};

// Mapeamento REVERSO: Converter valores simples para nomes completos com emojis
const FAMILIA_NOME_COMPLETO = {
    'C√≠trico': 'üçã Fresco/C√≠trico',
    'Foug√®re': 'üåø Arom√°tico/Verde',
    'Gourmand': 'üçØ Doce/Gourmand',
    'Amadeirado': 'ü™µ Amadeirado',
    'Especiado': 'üî• Especiado/Oriental',
    'Aqu√°tico': 'üåä Aqu√°tico',
    'Floral': 'üå∏ Floral',
    'Oriental': 'üçì Frutas'
};

const CLIMA_MAPPING = {
    'quente': 'quente',
    'temperado': 'temperado',
    'frio': 'frio'
};

const NIVEL_MAPPING = {
    'INICIANTE': 'iniciante',
    'INICIANTE/INTERMEDI√ÅRIO': 'intermediario',
    'INTERMEDI√ÅRIO': 'intermediario',
    'AVAN√áADO': 'avancado'
};

// Gerar bloco de sugest√µes personalizado
function generateRecommendationsBlock(checkboxes, climaRegiao, ambiente, level) {
    // Pegar checkboxes na ordem de clique
    const checkboxesOrdenados = getCheckboxesInClickOrder();
    
    // Capturar fam√≠lias selecionadas NA ORDEM DE CLIQUE
    const familiasSelecionadasKeys = [];
    checkboxesOrdenados.forEach(cb => {
        const familiaKey = cb.dataset.familia;
        if (FAMILIA_MAPPING[familiaKey]) {
            familiasSelecionadasKeys.push(FAMILIA_MAPPING[familiaKey]);
        }
    });
    
    console.log('üî¢ Ordem de clique:', familiaClickOrder);
    console.log('‚úÖ Fam√≠lias selecionadas (ordenadas):', familiasSelecionadasKeys);
    
    // Criar perfil do usu√°rio
    const userProfile = {
        familias: familiasSelecionadasKeys,
        clima: CLIMA_MAPPING[climaRegiao] || 'temperado',
        ambiente: ambiente || 'fechado',
        nivel: NIVEL_MAPPING[level] || 'intermediario'
    };
    
    console.log('üë§ Perfil do usu√°rio:', userProfile);
    
    // Obter top 3 recomenda√ß√µes
    const top3 = getTop3Recommendations(userProfile);
    
    console.log('üéØ Top 3 sugest√µes:', top3);
    
    // Gerar HTML
    return `
        <div style="
            background: linear-gradient(135deg, rgba(80, 80, 80, 0.3), rgba(50, 50, 50, 0.2));
            border: 3px solid rgba(212, 175, 55, 0.6);
            border-radius: 15px;
            padding: 25px;
        ">
            <div style="color: #d4af37; font-size: 1.3em; font-weight: 700; margin-bottom: 8px;">
                üéØ SUAS SUGEST√ïES PERSONALIZADAS
            </div>
            
            <div style="color: #fff; font-size: 1.3em; font-weight: 700; margin-bottom: 15px; text-align: center;">
                Sugest√£o 1 de 3
            </div>
            
            ${generatePerfumeCard(top3[0], 1, false)}
            
            <!-- Sugest√µes #2 e #3 - Embaixo dos CTAs (sem ocupar espa√ßo) -->
            <div style="position: relative;">
                <div style="position: absolute; top: 0; left: 0; right: 0; z-index: 1;">
                    ${generatePerfumeCard(top3[1], 2, true)}
                </div>
                
                <div style="position: absolute; top: 80px; left: 0; right: 0; z-index: 1;">
                    ${generatePerfumeCard(top3[2], 3, true)}
                </div>
            
            <!-- ====================================== -->
            <!-- COPYS DE VENDAS (POR CIMA DAS SUGEST√ïES) -->
            <!-- ====================================== -->
            
            <div style="position: relative; z-index: 10; background: linear-gradient(135deg, rgba(50, 50, 50, 0.98), rgba(40, 40, 40, 0.98)); padding: 15px; border-radius: 12px; margin-top: 10px; min-height: 600px;">
            
            <!-- 1. AGITA√á√ÉO (RENTE √ÄS SUGEST√ïES) -->
            <div style="
                background: linear-gradient(135deg, rgba(255, 107, 107, 0.1) 0%, rgba(255, 107, 107, 0.05) 100%);
                border: 2px solid rgba(255, 107, 107, 0.3);
                border-radius: 12px;
                padding: 20px;
                margin: 0 0 15px;
                text-align: center;
            ">
                <div style="font-size: 1.8em; margin-bottom: 10px;">‚ö†Ô∏è</div>
                <p style="color: #fff; font-size: 1.05em; line-height: 1.6; margin: 0; font-weight: 500;">
                    Voc√™ est√° vendo apenas <strong style="color: #ff6b6b;">1 de 3 sugest√µes</strong> personalizadas.<br>
                    E se ela n√£o estiver dispon√≠vel? E se voc√™ quiser uma op√ß√£o diferente?
                </p>
            </div>
            
            <!-- 2. CTA PRINCIPAL (LOGO ABAIXO DO BOX VERMELHO) -->
            <div style="text-align: center; margin: 20px 0;">
                <a href="https://pay.hotmart.com/M103540661D?checkoutMode=10" target="_blank" rel="noopener noreferrer" onclick="trackCTAClick('Mapa Completo IA'); return true;"
                   style="
                       display: inline-block;
                       background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                       color: #000;
                       padding: 18px 40px;
                       text-decoration: none;
                       border-radius: 12px;
                       font-weight: 700;
                       font-size: 1.1em;
                       box-shadow: 0 8px 25px rgba(212, 175, 55, 0.6);
                       transition: all 0.3s;
                       text-transform: uppercase;
                       letter-spacing: 0.5px;
                   "
                   onmouseover="this.style.transform='translateY(-4px) scale(1.03)'; this.style.boxShadow='0 12px 35px rgba(212, 175, 55, 0.8)'"
                   onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 8px 25px rgba(212, 175, 55, 0.6)'"
                >
                    üîì QUERO DESBLOQUEAR AGORA
                </a>
            </div>
            
            <!-- 3. BENEF√çCIOS + GARANTIA (LADO A LADO) -->
            <div style="
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                margin: 20px 0;
            ">
                <!-- BENEF√çCIOS (ESQUERDA) -->
                <div style="
                    background: rgba(255, 255, 255, 0.03);
                    border: 2px solid rgba(212, 175, 55, 0.3);
                    border-radius: 10px;
                    padding: 20px;
                ">
                    <div style="font-size: 1.5em; margin-bottom: 10px; text-align: center;">üéÅ</div>
                    <h4 style="color: #d4af37; margin: 0 0 15px; font-size: 1.1em; text-align: center; font-weight: 700;">
                        Voc√™ vai receber:
                    </h4>
                    <div style="color: #ccc; font-size: 0.9em; line-height: 1.8;">
                        ‚úÖ 3 Sugest√µes Personalizadas<br>
                        ‚úÖ O Perfumista - I.A. 24h<br>
                        ‚úÖ Guia de Fam√≠lias Olfativas<br>
                        ‚úÖ Boas Pr√°ticas de Aplica√ß√£o
                    </div>
                </div>
                
                <!-- GARANTIA (DIREITA) -->
                <div style="
                    background: linear-gradient(135deg, rgba(78, 205, 196, 0.12) 0%, rgba(78, 205, 196, 0.04) 100%);
                    border: 2px solid rgba(78, 205, 196, 0.35);
                    border-radius: 10px;
                    padding: 20px;
                ">
                    <div style="font-size: 1.5em; margin-bottom: 10px; text-align: center;">üõ°Ô∏è</div>
                    <h4 style="color: #4ecdc4; margin: 0 0 15px; font-size: 1.1em; text-align: center; font-weight: 700;">
                        Garantia de 7 Dias
                    </h4>
                    <div style="color: #fff; font-size: 0.9em; line-height: 1.8; text-align: center;">
                        Se n√£o gostar, devolvemos <strong style="color: #4ecdc4;">100% do dinheiro</strong>.<br>
                        <span style="color: #ccc; font-size: 0.85em;">Sem perguntas.<br>Sem burocracia.</span>
                    </div>
                </div>
            </div>
            
            <!-- 4. COMPARA√á√ÉO (ANTES vs DEPOIS) -->
            <div style="
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 12px;
                margin: 20px 0;
            ">
                <!-- SEM -->
                <div style="
                    background: rgba(255, 107, 107, 0.08);
                    border: 2px solid rgba(255, 107, 107, 0.25);
                    border-radius: 10px;
                    padding: 18px 15px;
                ">
                    <div style="font-size: 1.3em; margin-bottom: 8px; text-align: center;">üî¥</div>
                    <h4 style="color: #ff6b6b; margin: 0 0 12px; font-size: 1em; text-align: center; font-weight: 700;">
                        SEM O MAPA
                    </h4>
                    <div style="color: #ccc; font-size: 0.85em; line-height: 1.6;">
                        ‚ùå N√£o sabe quando usar<br>
                        ‚ùå Desperdi√ßa tempo testando<br>
                        ‚ùå Gasta R$ 500+ errado<br>
                        ‚ùå Compra sem orienta√ß√£o
                    </div>
                </div>
                
                <!-- COM -->
                <div style="
                    background: linear-gradient(135deg, rgba(78, 205, 196, 0.12) 0%, rgba(78, 205, 196, 0.04) 100%);
                    border: 2px solid rgba(78, 205, 196, 0.35);
                    border-radius: 10px;
                    padding: 18px 15px;
                ">
                    <div style="font-size: 1.3em; margin-bottom: 8px; text-align: center;">üü¢</div>
                    <h4 style="color: #4ecdc4; margin: 0 0 12px; font-size: 1em; text-align: center; font-weight: 700;">
                        COM O MAPA
                    </h4>
                    <div style="color: #fff; font-size: 0.85em; line-height: 1.6; font-weight: 500;">
                        ‚úÖ Sabe qual usar e quando<br>
                        ‚úÖ Economiza tempo e dinheiro<br>
                        ‚úÖ Compra o certo de primeira<br>
                        ‚úÖ I.A. 24h ao seu lado
                    </div>
                </div>
            </div>
            
            <!-- 5. CTA SECUND√ÅRIO (AMARELO) -->
            <div style="text-align: center; margin: 25px 0 30px;">
                <a href="https://pay.hotmart.com/M103540661D?checkoutMode=10" target="_blank" rel="noopener noreferrer" onclick="trackCTAClick('Mapa Completo IA - CTA2'); return true;"
                   style="
                       display: inline-block;
                       background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                       color: #000;
                       padding: 16px 40px;
                       text-decoration: none;
                       border-radius: 10px;
                       font-weight: 700;
                       font-size: 1em;
                       box-shadow: 0 6px 20px rgba(212, 175, 55, 0.5);
                       transition: all 0.3s;
                       text-transform: uppercase;
                   "
                   onmouseover="this.style.transform='translateY(-3px) scale(1.03)'"
                   onmouseout="this.style.transform='translateY(0) scale(1)'"
                >
                    üöÄ SIM, QUERO MEU ACESSO AGORA
                </a>
            </div>
            
            </div> <!-- Fecha div com z-index por cima -->
            </div> <!-- Fecha position relative -->
            
            <!-- Responsividade Mobile -->
            <style>
                @media (max-width: 768px) {
                    [style*="grid-template-columns: 1fr 1fr"] {
                        grid-template-columns: 1fr !important;
                    }
                }
            </style>
            
        </div>
    `;
}
        // Armazenar respostas do quiz
        const quizAnswers = {
            q1: null,
            q2: null,
            q3: null
        };

        function selectOption(question, value, button) {
            // Salvar resposta
            quizAnswers[`q${question}`] = value;
            
            // Remover sele√ß√£o de todos os bot√µes da mesma pergunta
            const allButtons = button.parentElement.querySelectorAll('.option-btn');
            allButtons.forEach(btn => btn.classList.remove('selected'));
            
            // Selecionar bot√£o clicado
            button.classList.add('selected');
            
            // Habilitar bot√£o "Pr√≥xima"
            const nextBtn = document.getElementById(`next-${question}`);
            nextBtn.classList.add('enabled');
        }

        function nextQuestion(current) {
            // ENVIAR DADOS DA PERGUNTA ATUAL
            const etapa = `Pergunta ${current}`;
            const resposta = quizAnswers[`q${current}`];
            
            sendToSheet({
                etapa: etapa,
                q1: quizAnswers.q1,
                q2: quizAnswers.q2,
                q3: quizAnswers.q3,
                status: 'Em andamento'
            });
            
            // Esconder pergunta atual
            document.getElementById(`quiz-${current}`).classList.remove('active');
            
            // Mostrar pr√≥xima pergunta
            const next = current + 1;
            document.getElementById(`quiz-${next}`).classList.add('active');
            
            // Scroll para o topo
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function comecarDiagnostico() {
            // Esconder hero section
            document.getElementById('hero-section').classList.remove('active');
            
            // Mostrar quiz-1
            document.getElementById('quiz-1').classList.add('active');
            
            // Scroll para o topo
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Track evento
            trackEvent('iniciar_diagnostico_hero');
            console.log('‚úÖ Usu√°rio escolheu "Melhorar Cole√ß√£o" - Iniciando quiz');
        }

        function startDiagnostic() {
            // Salvar respostas do quiz no localStorage
            localStorage.setItem('quiz_answers', JSON.stringify(quizAnswers));
            
            // ENVIAR DADOS: Completou Quiz
            sendToSheet({
                etapa: 'Quiz Completo',
                q1: quizAnswers.q1,
                q2: quizAnswers.q2,
                q3: quizAnswers.q3,
                status: 'Iniciou Diagn√≥stico'
            });
            
            // Esconder quiz
            document.getElementById('quiz-3').style.display = 'none';
            
            // Mostrar se√ß√£o de diagn√≥stico
            document.getElementById('diagnostic-section').style.display = 'block';
            
            // Scroll para o topo
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        const SHEET_URL = 'https://script.google.com/macros/s/AKfycbwVsf5BS_uSNmcGHzM8NTXlhquBXQ7qwejle6NpB7g4rUfdXnIkGrqW937ZeOXp9xQ/exec';

        // Fun√ß√£o para enviar dados ao Google Sheets
        function sendToSheet(data) {
            fetch(SHEET_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            }).catch(error => console.log('Dados enviados'));
        }


        // Analisar cole√ß√£o com loading
        function analyzeCollection() {
            // VALIDAR AMBIENTE OBRIGAT√ìRIO
            const ambiente = document.getElementById('ambiente').value;
            if (!ambiente || ambiente === '') {
                alert('‚ö†Ô∏è Por favor, selecione seu ambiente de trabalho!');
                document.getElementById('ambiente').focus();
                return;
            }
            
            // VALIDAR CLIMA OBRIGAT√ìRIO
            const climaSelecionado = document.querySelector('.clima-btn.selected-quente, .clima-btn.selected-temperado, .clima-btn.selected-frio');
            if (!climaSelecionado) {
                alert('‚ö†Ô∏è Por favor, selecione o clima da sua regi√£o!');
                return;
            }
            
            
            
            // Coletar fam√≠lias marcadas (checkboxes)
            const checkboxes = document.querySelectorAll('.familia-checkbox:checked');
            
            if (checkboxes.length === 0) {
                alert('Marque pelo menos 1 fam√≠lia para analisar');
                return;
            }
            
            // Criar objeto families baseado nas checkboxes marcadas
            // Primeira marcada = valor mais alto (dominante)
            // Segunda = valor m√©dio
            // Terceira = valor menor
            const families = {
                'fresco': { name: 'üçã Fresco/C√≠trico', value: 0 },
                'aromatico': { name: 'üåø Arom√°tico/Verde', value: 0 },
                'doce': { name: 'üçØ Doce/Gourmand', value: 0 },
                'amadeirado': { name: 'ü™µ Amadeirado', value: 0 },
                'especiado': { name: 'üî• Especiado/Oriental', value: 0 },
                'aquatico': { name: 'üåä Aqu√°tico', value: 0 },
                'talco': { name: 'üßº Talco/Foug√®re', value: 0 },
                'floral': { name: 'üå∏ Floral', value: 0 },
                'frutas': { name: 'üçì Frutas', value: 0 }
            };
            
            // Atribuir valores baseado na ordem de sele√ß√£o
            checkboxes.forEach((checkbox, index) => {
                const familia = checkbox.dataset.familia;
                if (index === 0) {
                    families[familia].value = 10; // Dominante
                } else if (index === 1) {
                    families[familia].value = 5; // Segunda
                } else if (index === 2) {
                    families[familia].value = 3; // Terceira
                }
            });
            
            const total = checkboxes.length * 6; // Simular total de perfumes

            // MOSTRAR POPUP DE LOADING
            mostrarLoading();

            // Simular processamento por 2.5 segundos
            setTimeout(() => {
                fecharLoading();
                processarAnalise(families, total);
            }, 2500);
        }

        function mostrarLoading() {
            const overlay = document.createElement('div');
            overlay.id = 'loading-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            `;

            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                    border: 3px solid #d4af37;
                    border-radius: 20px;
                    padding: 50px 60px;
                    text-align: center;
                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.5);
                    animation: slideUp 0.4s ease;
                ">
                    <div style="font-size: 4em; margin-bottom: 20px; animation: spin 1.5s linear infinite;">
                        üîÑ
                    </div>
                    <div style="color: #d4af37; font-size: 1.8em; font-weight: 700; margin-bottom: 15px;">
                        Analisando sua cole√ß√£o...
                    </div>
                    <div style="color: #ccc; font-size: 1em; margin-bottom: 25px;">
                        Processando dados e identificando padr√µes
                    </div>
                    
                    <div style="
                        width: 300px;
                        height: 8px;
                        background: rgba(212, 175, 55, 0.2);
                        border-radius: 10px;
                        overflow: hidden;
                        margin: 0 auto;
                    ">
                        <div id="progress-bar" style="
                            width: 0%;
                            height: 100%;
                            background: linear-gradient(90deg, #d4af37, #f4e5b1);
                            border-radius: 10px;
                            transition: width 0.3s ease;
                        "></div>
                    </div>
                </div>
            `;

            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
                @keyframes fadeIn {
                    from { opacity: 0; }
                    to { opacity: 1; }
                }
                @keyframes slideUp {
                    from { transform: translateY(30px); opacity: 0; }
                    to { transform: translateY(0); opacity: 1; }
                }
                @keyframes fadeOut {
                    from { opacity: 1; }
                    to { opacity: 0; }
                }
            `;
            document.head.appendChild(style);

            document.body.appendChild(overlay);

            let progress = 0;
            const interval = setInterval(() => {
                progress += 4;
                const bar = document.getElementById('progress-bar');
                if (bar) bar.style.width = progress + '%';
                if (progress >= 100) clearInterval(interval);
            }, 100);
        }

        function fecharLoading() {
            const overlay = document.getElementById('loading-overlay');
            if (overlay) {
                overlay.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => overlay.remove(), 300);
            }
        }


        // Fun√ß√£o: Selecionar Clima
        function selecionarClima(clima, btn) {
            // Remover todas as classes de sele√ß√£o
            document.querySelectorAll('.clima-btn').forEach(function(b) {
                b.classList.remove('selected-quente');
                b.classList.remove('selected-temperado');
                b.classList.remove('selected-frio');
            });
            
            // Adicionar classe espec√≠fica do clima
            btn.classList.add('selected-' + clima);
            
            document.getElementById('clima').value = clima;
            localStorage.setItem('clima', clima);
        }

        // L√ìGICA INTELIGENTE: Selecionar 3 melhores fam√≠lias faltantes
        function selecionarMelhoresFamilias(familiasFaltando, clima, ambiente) {
            // Score de cada fam√≠lia por contexto
            const scores = {
                'fresco': {
                    'quente': 10, 'temperado': 8, 'frio': 4,
                    'fechado': 9, 'aberto': 7, 'ambos': 8
                },
                'aromatico': {
                    'quente': 7, 'temperado': 9, 'frio': 6,
                    'fechado': 8, 'aberto': 9, 'ambos': 9
                },
                'doce': {
                    'quente': 4, 'temperado': 7, 'frio': 10,
                    'fechado': 6, 'aberto': 8, 'ambos': 7
                },
                'amadeirado': {
                    'quente': 6, 'temperado': 9, 'frio': 10,
                    'fechado': 10, 'aberto': 7, 'ambos': 9
                },
                'especiado': {
                    'quente': 5, 'temperado': 8, 'frio': 10,
                    'fechado': 7, 'aberto': 8, 'ambos': 8
                },
                'aquatico': {
                    'quente': 10, 'temperado': 8, 'frio': 5,
                    'fechado': 8, 'aberto': 9, 'ambos': 9
                },
                'talco': {
                    'quente': 8, 'temperado': 9, 'frio': 7,
                    'fechado': 10, 'aberto': 6, 'ambos': 8
                },
                'floral': {
                    'quente': 7, 'temperado': 9, 'frio': 6,
                    'fechado': 8, 'aberto': 9, 'ambos': 8
                },
                'frutas': {
                    'quente': 9, 'temperado': 8, 'frio': 5,
                    'fechado': 7, 'aberto': 9, 'ambos': 8
                }
            };

            // Calcular score total para cada fam√≠lia faltando
            const familiasComScore = familiasFaltando.map(familia => {
                const scoreClima = scores[familia.key]?.[clima] || 5;
                const scoreAmbiente = scores[familia.key]?.[ambiente] || 5;
                const scoreTotal = scoreClima + scoreAmbiente;
                
                return {
                    ...familia,
                    score: scoreTotal
                };
            });

            // Ordenar por score (maior para menor) e pegar top 3
            return familiasComScore
                .sort((a, b) => b.score - a.score)
                .slice(0, 3);
        }
        function processarAnalise(families, total) {
            const climaRegiao = document.getElementById('clima').value || 'temperado';
            const ambiente = document.getElementById('ambiente').value || 'ambos';
            
            // Pegar checkboxes marcadas para passar para recomenda√ß√µes
            const checkboxes = document.querySelectorAll('.familia-checkbox:checked');
            
            // Calcular n√≠vel baseado em quantas fam√≠lias marcou
            let level = '';
            if (checkboxes.length === 1) {
                level = 'INICIANTE';
            } else if (checkboxes.length === 2) {
                level = 'INICIANTE/INTERMEDI√ÅRIO';
            } else if (checkboxes.length === 3) {
                level = 'INTERMEDI√ÅRIO';
            } else {
                level = 'AVAN√áADO';
            }

            // Pegar fam√≠lias que a pessoa TEM (value > 0)
            const familiasTem = [];
            Object.entries(families).forEach(([key, data]) => {
                if (data.value > 0) {
                    familiasTem.push({ key, ...data });
                }
            });

            // Pegar fam√≠lias que FALTAM
            const familiasFaltam = [];
            Object.entries(families).forEach(([key, data]) => {
                if (data.value === 0) {
                    familiasFaltam.push({ key, ...data });
                }
            });

            const totalFamilias = familiasTem.length;

            // Emojis de clima
            const climaEmojis = {
                'quente': '‚òÄÔ∏è Quente',
                'temperado': 'üå§Ô∏è Temperado',
                'frio': '‚ùÑÔ∏è Frio'
            };

            // Montar cards de info
            const dominantDiv = document.getElementById('dominant-family');
            const infoCards = `
                <div style="
                    display: grid;
                    grid-template-columns: repeat(3, 1fr);
                    gap: 12px;
                    margin-bottom: 20px;
                ">
                    <div style="
                        background: linear-gradient(135deg, rgba(100, 150, 255, 0.15), rgba(100, 150, 255, 0.05));
                        border: 2px solid rgba(100, 150, 255, 0.4);
                        border-radius: 8px;
                        padding: 12px;
                    ">
                        <div style="font-size: 0.85em; color: #9bc4ff; margin-bottom: 6px; font-weight: 600;">üå°Ô∏è CLIMA</div>
                        <div style="color: #fff; font-size: 0.95em; line-height: 1.5;">
                            ${climaEmojis[climaRegiao]}
                        </div>
                    </div>
                    
                    <div style="
                        background: linear-gradient(135deg, rgba(100, 150, 255, 0.15), rgba(100, 150, 255, 0.05));
                        border: 2px solid rgba(100, 150, 255, 0.4);
                        border-radius: 8px;
                        padding: 12px;
                    ">
                        <div style="font-size: 0.85em; color: #9bc4ff; margin-bottom: 6px; font-weight: 600;">üíº AMBIENTE</div>
                        <div style="color: #fff; font-size: 0.95em;">
                            ${{'fechado': 'Fechado', 'aberto': 'Aberto', 'ambos': 'Ambos'}[ambiente]}
                        </div>
                    </div>
                    
                    <div style="
                        background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
                        border: 2px solid rgba(212, 175, 55, 0.4);
                        border-radius: 8px;
                        padding: 12px;
                    ">
                        <div style="font-size: 0.85em; color: #d4af37; margin-bottom: 6px; font-weight: 600;">üéØ FAM√çLIAS</div>
                        <div style="color: #fff; font-size: 1.3em; font-weight: 700;">${totalFamilias}/9</div>
                    </div>
                </div>
                
                <style>
                    @media (max-width: 768px) {
                        #dominant-family > div:first-child {
                            grid-template-columns: 1fr !important;
                        }
                    }
                </style>
            `;

            dominantDiv.innerHTML = infoCards;

            // NOVO DIAGN√ìSTICO
            const adviceDiv = document.getElementById('balance-advice');
            
            // Montar lista de fam√≠lias que TEM
            const nomesFamiliasTem = familiasTem.map(f => f.name).join(', ');
            
            // Selecionar TOP 3 fam√≠lias priorit√°rias baseado em clima + ambiente
            const top3Prioritarias = selecionarMelhoresFamilias(familiasFaltam, climaRegiao, ambiente);
            
            // Criar lista VERTICAL com prioridades
            let listaPrioridades = '';
            if (top3Prioritarias.length > 0) {
                const emojis = ['üî¥', 'üîµ', 'üü¢'];
                const titulos = ['PRIORIDADE 1', 'PRIORIDADE 2', 'PRIORIDADE 3'];
                const cores = ['#ff6b6b', '#4ecdc4', '#95e1d3'];
                
                listaPrioridades = top3Prioritarias.map((familia, index) => `
                    <div style="
                        margin-bottom: 15px;
                        padding: 15px;
                        background: rgba(0, 0, 0, 0.3);
                        border-left: 4px solid ${cores[index]};
                        border-radius: 8px;
                    ">
                        <div style="color: ${cores[index]}; font-size: 0.9em; font-weight: 700; margin-bottom: 5px;">
                            ${emojis[index]} ${titulos[index]}
                        </div>
                        <div style="color: #fff; font-size: 1.2em; font-weight: 600;">
                            ${familia.name}
                        </div>
                    </div>
                `).join('');
            } else {
                listaPrioridades = '<div style="color: #ccc;">Voc√™ j√° tem uma cole√ß√£o diversificada!</div>';
            }

            let diagnostico = `
                <div style="text-align: center; margin-bottom: 15px;">
                    <div style="
                        display: inline-block;
                        background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(212, 175, 55, 0.1));
                        border: 2px solid #d4af37;
                        border-radius: 8px;
                        padding: 10px 30px;
                    ">
                        <span style="color: #d4af37; font-size: 1.3em; font-weight: 700; letter-spacing: 2px;">
                            üìã DIAGN√ìSTICO
                        </span>
                    </div>
                </div>
                
                <div style="
                    background: linear-gradient(135deg, rgba(100, 150, 255, 0.15), rgba(100, 150, 255, 0.05));
                    border-left: 5px solid #9bc4ff;
                    padding: 20px;
                    border-radius: 8px;
                    margin-bottom: 20px;
                ">
                    <div style="color: #9bc4ff; font-size: 1.2em; font-weight: 700; margin-bottom: 15px;">
                        ‚úÖ FAM√çLIAS NA SUA COLE√á√ÉO:
                    </div>
                    <div style="color: #fff; font-size: 1.1em; line-height: 1.6;">
                        ${nomesFamiliasTem || 'Nenhuma fam√≠lia selecionada'}
                    </div>
                </div>
                
                <div style="
                    background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
                    border-left: 5px solid #d4af37;
                    padding: 20px;
                    border-radius: 8px;
                ">
                    <div style="color: #d4af37; font-size: 1.3em; font-weight: 700; margin-bottom: 15px;">
                        üéØ TOP 3 Fam√≠lias Priorit√°rias para voc√™:
                    </div>
                    <div style="font-size: 1em; color: #f4e5b1; line-height: 1.6; margin-bottom: 20px;">
                        Com base no seu <strong style="color: #fff;">clima ${climaEmojis[climaRegiao]}</strong> e 
                        ambiente <strong style="color: #fff;">${{'fechado': 'üè¢ fechado', 'aberto': 'üå≥ aberto', 'ambos': 'üîÑ variado'}[ambiente]}</strong>, 
                        estas s√£o as fam√≠lias mais importantes para voc√™ adicionar:
                    </div>
                    ${listaPrioridades}
                </div>
            `;


            // Sugest√µes em largura total
            let nextPurchase = `
                <div style="margin-top: 30px;">
                    <!-- SUGEST√ïES PERSONALIZADAS (DIN√ÇMICO) -->
                    ${generateRecommendationsBlock(checkboxes, climaRegiao, ambiente, level)}
                </div>
            `;
            
            // Adicionar os CTAs ao adviceDiv
            adviceDiv.innerHTML = diagnostico + nextPurchase;

            // Mostrar resultado
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.scrollIntoView({ behavior: 'smooth' });

            // ABRIR POPUP DE CAPTURA AUTOMATICAMENTE
            setTimeout(() => {
                abrirPopupCaptura();
            }, 500);
        }

        // Popup para quem n√£o sabe nada de perfumes

        // ABRIR POPUP DE CAPTURA
        function abrirPopupCaptura() {
            document.getElementById('popup-captura').style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevenir scroll
        }

        // FECHAR POPUP DE CAPTURA
        function fecharPopupCaptura() {
            document.getElementById('popup-captura').style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // DESBLOQUEAR RESULTADO
        function desbloquearResultado() {
            const resultDiv = document.getElementById('result');
            resultDiv.style.filter = 'none';
            resultDiv.style.pointerEvents = 'auto';
            resultDiv.style.userSelect = 'auto';
        }

        // INICIALIZAR EMAILJS
        (function() {
            emailjs.init("fyJYlmRYKOsvdjMjZ"); // VOC√ä PRECISA SUBSTITUIR
        })();

        // ============================================
        // CONTADORES SOCIAL PROOF INDIVIDUAIS
        // ============================================
        
        function generateCounter(elementId, storageKey, baseMin, baseMax, hourlyMin, hourlyMax) {
            const counterEl = document.getElementById(elementId);
            if (!counterEl) return;
            
            // Gerar n√∫mero baseado na data + hora (consistente durante o dia)
            const today = new Date();
            const dateKey = `${today.getFullYear()}-${today.getMonth()}-${today.getDate()}`;
            
            // Verificar se j√° temos um valor salvo para hoje
            const savedData = localStorage.getItem(storageKey);
            if (savedData) {
                try {
                    const parsed = JSON.parse(savedData);
                    if (parsed.date === dateKey) {
                        // Usar valor salvo
                        counterEl.textContent = parsed.count;
                        console.log(`üî• ${storageKey}:`, parsed.count, '(cached)');
                        return;
                    }
                } catch(e) {}
            }
            
            // Gerar novo n√∫mero para hoje
            // Hash simples da data para consist√™ncia
            const dateHash = dateKey.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
            const dailyVariation = dateHash % (baseMax - baseMin);
            const baseCount = baseMin + dailyVariation;
            
            // Incremento baseado na hora (manh√£ < tarde < noite)
            const hour = today.getHours();
            let hourBoost = 0;
            if (hour >= 6 && hour < 12) {
                hourBoost = Math.floor(Math.random() * (hourlyMax * 0.25)); // Manh√£: 25%
            } else if (hour >= 12 && hour < 18) {
                hourBoost = Math.floor(hourlyMax * 0.25) + Math.floor(Math.random() * (hourlyMax * 0.35)); // Tarde: 25-60%
            } else if (hour >= 18 && hour < 24) {
                hourBoost = Math.floor(hourlyMax * 0.6) + Math.floor(Math.random() * (hourlyMax * 0.4)); // Noite: 60-100%
            } else {
                hourBoost = Math.floor(Math.random() * (hourlyMax * 0.1)); // Madrugada: 0-10%
            }
            
            const finalCount = baseCount + hourBoost;
            
            // Salvar no localStorage
            const dataToSave = {
                date: dateKey,
                count: finalCount
            };
            localStorage.setItem(storageKey, JSON.stringify(dataToSave));
            
            // Exibir com anima√ß√£o
            counterEl.style.opacity = '0';
            setTimeout(() => {
                counterEl.textContent = finalCount;
                counterEl.style.transition = 'opacity 0.5s ease';
                counterEl.style.opacity = '1';
            }, 100);
            
            console.log(`üî• ${storageKey}:`, finalCount, '(new)');
        }
        
        function initSocialProofCounters() {
            // CONTADOR 1: Iniciantes (descobriram a perfumaria)
            // Menor volume, mais iniciantes
            generateCounter('counter-iniciante', 'counter_iniciante', 80, 180, 0, 90);
            
            // CONTADOR 2: Colecionadores (melhoraram cole√ß√£o)
            // Maior volume, p√∫blico mais engajado
            generateCounter('counter-colecao', 'counter_colecao', 150, 280, 0, 120);
        }
        
        // Inicializar contadores quando p√°gina carregar
        document.addEventListener('DOMContentLoaded', initSocialProofCounters);

        // ENVIAR EMAIL COM DIAGN√ìSTICO
        // ENVIAR EMAIL COM DIAGN√ìSTICO
        function enviarDiagnostico(nome, email) {
            console.log('üöÄ Iniciando envio de diagn√≥stico...');
            
            // Capturar clima e ambiente
            const climaRegiao = document.getElementById('clima').value || 'temperado';
            const ambiente = document.getElementById('ambiente').value || 'ambos';
            
            // Pegar fam√≠lias selecionadas dos checkboxes (N√ÉO de inputs num√©ricos!)
            const checkboxes = document.querySelectorAll('.familia-checkbox:checked');
            
            console.log('‚úÖ Checkboxes selecionadas:', checkboxes.length);
            
            const familiasSelecionadas = [];
            const families = {
                'fresco': { name: 'üçã Fresco/C√≠trico', value: 0 },
                'aromatico': { name: 'üåø Arom√°tico/Verde', value: 0 },
                'doce': { name: 'üçØ Doce/Gourmand', value: 0 },
                'amadeirado': { name: 'ü™µ Amadeirado', value: 0 },
                'especiado': { name: 'üî• Especiado/Oriental', value: 0 },
                'aquatico': { name: 'üåä Aqu√°tico', value: 0 },
                'talco': { name: 'üßº Talco/Foug√®re', value: 0 },
                'floral': { name: 'üå∏ Floral', value: 0 },
                'frutas': { name: 'üçì Frutas', value: 0 }
            };
            
            // Atribuir valores baseado na ordem
            checkboxes.forEach((checkbox, index) => {
                const familiaKey = checkbox.dataset.familia;
                if (index === 0) {
                    families[familiaKey].value = 10; // Dominante
                } else if (index === 1) {
                    families[familiaKey].value = 5; // Segunda
                } else if (index === 2) {
                    families[familiaKey].value = 3; // Terceira
                }
            });
            
            // Calcular totais
            const totalPerfumes = checkboxes.length * 6; // Simular
            const totalFamilias = checkboxes.length;
            
            // Calcular dominante
            let dominant = null;
            let maxValue = 0;
            Object.entries(families).forEach(([key, data]) => {
                if (data.value > maxValue) {
                    maxValue = data.value;
                    dominant = { key, ...data };
                }
            });
            
            const percentage = totalPerfumes > 0 ? ((maxValue / (maxValue + 5 + 3)) * 100).toFixed(0) : 0;
            const familiaDominanteNome = dominant ? `${dominant.name}` : 'Nenhuma';
            const familiaDominanteDetalhes = dominant ? `${checkboxes.length >= 1 ? 'Fam√≠lia principal' : 'N/A'}` : '';
            
            // Calcular n√≠vel baseado em quantas fam√≠lias marcou
            let level = '';
            if (checkboxes.length === 1) {
                level = 'INICIANTE';
            } else if (checkboxes.length === 2) {
                level = 'INICIANTE/INTERMEDI√ÅRIO';
            } else if (checkboxes.length === 3) {
                level = 'INTERMEDI√ÅRIO';
            } else {
                level = 'AVAN√áADO';
            }
            
            // Capturar diagn√≥stico (pode n√£o existir ainda)
            let diagnostico = 'Diagn√≥stico em processamento...';
            const adviceEl = document.getElementById('balance-advice');
            if (adviceEl && adviceEl.innerText) {
                diagnostico = adviceEl.innerText;
            }
            
            // Criar diagn√≥stico resumido
            let diagnosticoResumido = `N√≠vel: ${level}\nFam√≠lias selecionadas: ${checkboxes.length}/9`;
            
            // Emojis de clima
            const climaEmojis = {
                'quente': '‚òÄÔ∏è Quente',
                'temperado': 'üå§Ô∏è Temperado',
                'frio': '‚ùÑÔ∏è Frio'
            };
            
            const ambienteNomes = {
                'fechado': 'üè¢ Fechado',
                'aberto': 'üå≥ Aberto',
                'ambos': 'üîÑ Ambos'
            };
            
            // ============================================
            // BUSCAR SUGEST√ïES PERSONALIZADAS PARA EMAIL
            // ============================================
            
            // Pegar checkboxes na ordem de clique
            const checkboxesOrdenados = getCheckboxesInClickOrder();
            
            // Capturar fam√≠lias selecionadas NA ORDEM DE CLIQUE
            const familiasSelecionadasKeys = [];
            checkboxesOrdenados.forEach(cb => {
                const familiaKey = cb.dataset.familia;
                if (FAMILIA_MAPPING[familiaKey]) {
                    familiasSelecionadasKeys.push(FAMILIA_MAPPING[familiaKey]);
                }
            });
            
            console.log('üìß [EMAIL] Ordem de clique:', familiaClickOrder);
            console.log('üìß [EMAIL] Fam√≠lias ordenadas:', familiasSelecionadasKeys);
            
            // Criar perfil do usu√°rio
            const userProfile = {
                familias: familiasSelecionadasKeys,
                clima: CLIMA_MAPPING[climaRegiao] || 'temperado',
                ambiente: ambiente || 'fechado',
                nivel: NIVEL_MAPPING[level] || 'intermediario'
            };
            
            // Obter top 3 recomenda√ß√µes
            const top3 = getTop3Recommendations(userProfile);
            
            console.log('üéØ Top 3 para email:', top3);
            
            // Formatar sugest√µes para email (vari√°veis separadas)
            const sugestao1_nome = top3[0].nome;
            const sugestao1_marca = top3[0].marca;
            const sugestao1_familia = top3[0].familia;
            const sugestao1_notas = top3[0].notas;
            const sugestao1_preco = top3[0].preco;
            const sugestao1_desc = top3[0].desc;
            
            // Capturar prioridades para email (USAR NOMES COMPLETOS COM EMOJIS)
            const prioridade1 = familiasSelecionadasKeys[0] ? (FAMILIA_NOME_COMPLETO[familiasSelecionadasKeys[0]] || familiasSelecionadasKeys[0]) : 'N√£o selecionada';
            const prioridade2 = familiasSelecionadasKeys[1] ? (FAMILIA_NOME_COMPLETO[familiasSelecionadasKeys[1]] || familiasSelecionadasKeys[1]) : 'N√£o selecionada';
            const prioridade3 = familiasSelecionadasKeys[2] ? (FAMILIA_NOME_COMPLETO[familiasSelecionadasKeys[2]] || familiasSelecionadasKeys[2]) : 'N√£o selecionada';
            
            console.log('üìã Prioridades para email:', { prioridade1, prioridade2, prioridade3 });
            
            // ============================================
            // FIM DAS SUGEST√ïES
            // ============================================
            
            const templateParams = {
                to_name: nome,
                to_email: email,
                nivel: level,
                clima: climaEmojis[climaRegiao] || climaRegiao,
                ambiente: ambienteNomes[ambiente] || ambiente,
                // total_perfumes: totalPerfumes,
                total_familias: totalFamilias,
                // familia_dominante_nome: familiaDominanteNome,
                // familia_dominante_detalhes: familiaDominanteDetalhes,
                diagnostico_resumido: diagnosticoResumido,
                quiz_q1: quizAnswers.q1 || 'n√£o respondido',
                quiz_q2: quizAnswers.q2 || 'n√£o respondido',
                quiz_q3: quizAnswers.q3 || 'n√£o respondido',
                prioridade1: prioridade1,
                prioridade2: prioridade2,
                prioridade3: prioridade3,
                perfume_nome: sugestao1_nome,
                perfume_marca: sugestao1_marca,
                perfume_familia: sugestao1_familia,
                perfume_notas: sugestao1_notas,
                perfume_preco: sugestao1_preco,
                perfume_desc: sugestao1_desc
            };
            
            console.log('üìß Enviando com params:', templateParams);
            
            // ============================================
            // ENVIAR DADOS PARA GOOGLE SHEETS
            // ============================================
            
            
            // Capturar dados de tracking
            console.log('üîç Lendo localStorage cta_tracking...');
            const ctaTrackingRaw = localStorage.getItem('cta_tracking');
            console.log('üì¶ localStorage RAW:', ctaTrackingRaw);
            
            const ctaTracking = JSON.parse(ctaTrackingRaw || '{}');
            console.log('üìã ctaTracking parseado:', ctaTracking);
            console.log('üéØ CTA que vai ser enviado:', ctaTracking.cta_clicado || 'Nenhum');
            
            const urlParams = new URLSearchParams(window.location.search);
            
            const sheetsData = {
                timestamp: new Date().toLocaleString('pt-BR'),
                to_name: nome,
                to_email: email,
                nivel: level,
                clima: climaEmojis[climaRegiao] || climaRegiao,
                ambiente: ambienteNomes[ambiente] || ambiente,
                total_familias: totalFamilias,
                diagnostico_resumido: diagnosticoResumido,
                quiz_q1: quizAnswers.q1 || 'n√£o respondido',
                quiz_q2: quizAnswers.q2 || 'n√£o respondido',
                quiz_q3: quizAnswers.q3 || 'n√£o respondido',
                cta_clicado: ctaTracking.cta_clicado || 'Nenhum',
                data_clique_cta: ctaTracking.data_clique || '-',
                screen: window.screen.width + '√ó' + window.screen.height,
                device_type: /Mobile|Android|iPhone|iPad/i.test(navigator.userAgent) ? 'mobile' : 'desktop',
                browser: (navigator.userAgent.match(/(Firefox|Chrome|Safari|Edge|Opera)/) || ['Other'])[0],
                utm_source: urlParams.get('utm_source') || '-',
                utm_medium: urlParams.get('utm_medium') || '-',
                utm_campaign: urlParams.get('utm_campaign') || '-',
                utm_content: urlParams.get('utm_content') || '-',
                utm_term: urlParams.get('utm_term') || '-'
            };
            
            console.log('üìä Dados para Sheets:', sheetsData);
            
            // Enviar para Google Sheets via GET com URL parameters
            const SHEETS_URL = 'https://script.google.com/macros/s/AKfycbwVsf5BS_uSNmcGHzM8NTXlhquBXQ7qwejle6NpB7g4rUfdXnIkGrqW937ZeOXp9xQ/exec';
            
            try {
                // Criar URL com par√¢metros
                const params = new URLSearchParams();
                
                // Adicionar cada campo como par√¢metro separado
                params.append('timestamp', sheetsData.timestamp);
                params.append('to_name', sheetsData.to_name);
                params.append('to_email', sheetsData.to_email);
                params.append('nivel', sheetsData.nivel);
                params.append('clima', sheetsData.clima);
                params.append('ambiente', sheetsData.ambiente);
                params.append('total_familias', sheetsData.total_familias);
                params.append('diagnostico_resumido', sheetsData.diagnostico_resumido);
                params.append('quiz_q1', sheetsData.quiz_q1);
                params.append('quiz_q2', sheetsData.quiz_q2);
                params.append('quiz_q3', sheetsData.quiz_q3);
                params.append('cta_clicado', sheetsData.cta_clicado);
                params.append('data_clique_cta', sheetsData.data_clique_cta);
                params.append('screen', sheetsData.screen);
                params.append('device_type', sheetsData.device_type);
                params.append('browser', sheetsData.browser);
                params.append('utm_source', sheetsData.utm_source);
                params.append('utm_medium', sheetsData.utm_medium);
                params.append('utm_campaign', sheetsData.utm_campaign);
                params.append('utm_content', sheetsData.utm_content);
                params.append('utm_term', sheetsData.utm_term);
                
                const finalUrl = SHEETS_URL + '?' + params.toString();
                
                console.log('üì§ Enviando via GET para:', finalUrl.substring(0, 150) + '...');
                
                // Criar iframe invis√≠vel
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = finalUrl;
                document.body.appendChild(iframe);
                
                console.log('‚úÖ Dados enviados para Google Sheets!');
                
                // Remover iframe ap√≥s 3 segundos
                setTimeout(() => {
                    try {
                        document.body.removeChild(iframe);
                    } catch(e) {}
                }, 3000);
            } catch(error) {
                console.error('‚ùå Erro ao enviar para Sheets:', error);
            }
            
            // ============================================
            // FIM DO ENVIO PARA GOOGLE SHEETS
            // ============================================


            return emailjs.send('service_gy6byvf', 'template_fl5funp', templateParams)
                .then(response => {
                    console.log('‚úÖ Email enviado com sucesso!', response);
                    
                    // META PIXEL: Evento Lead
                    if (typeof fbq !== 'undefined') {
                        fbq('track', 'Lead', {
                            content_name: 'Diagn√≥stico de Perfumaria',
                            content_category: 'Lead Magnet'
                        });
                    }
                    
                    return response;
                })
                .catch(error => {
                    console.error('‚ùå Erro ao enviar email:', error);
                    throw error;
                });
        }

        // HANDLER DO FORMUL√ÅRIO
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('form-captura');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const nome = document.getElementById('capture-name').value;
                    const email = document.getElementById('capture-email').value;
                    
                    if (!nome || !email) {
                        alert('Por favor, preencha todos os campos!');
                        return;
                    }
                    
                    // Desabilitar bot√£o
                    const btn = form.querySelector('button[type="submit"]');
                    btn.disabled = true;
                    btn.innerHTML = '‚è≥ ENVIANDO...';
                    
                    // Enviar email
                    enviarDiagnostico(nome, email)
                        .then(function(response) {
                            console.log('Email enviado!', response);
                            
                            // Fechar popup
                            fecharPopupCaptura();
                            
                            // Desbloquear resultado
                            desbloquearResultado();
                            
                            // Enviar para Google Sheets tamb√©m
                            sendToSheet({
                                etapa: 'Converteu',
                                q1: quizAnswers.q1,
                                q2: quizAnswers.q2,
                                q3: quizAnswers.q3,
                                nome: nome,
                                email: email,
                                status: 'Lead Capturado'
                            });
                        })
                        .catch(function(error) {
                            console.error('Erro ao enviar:', error);
                            alert('Erro ao enviar. Tente novamente!');
                            btn.disabled = false;
                            btn.innerHTML = 'üöÄ QUERO MEU DIAGN√ìSTICO!';
                        });
                });
            }
        });
        function abrirPopupIniciante() {
            // MOSTRAR LOADING
            mostrarLoadingIniciante();

            // Ap√≥s 2 segundos, fecha loading e abre popup
            setTimeout(() => {
                fecharLoading();
                mostrarPopupIniciante();
            }, 2000);
        }

        function mostrarLoadingIniciante() {
            const overlay = document.createElement('div');
            overlay.id = 'loading-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            `;

            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                    border: 3px solid #d4af37;
                    border-radius: 20px;
                    padding: 50px 60px;
                    text-align: center;
                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.5);
                    animation: slideUp 0.4s ease;
                ">
                    <div style="font-size: 4em; margin-bottom: 20px; animation: spin 1.5s linear infinite;">
                        ü§î
                    </div>
                    <div style="color: #d4af37; font-size: 1.8em; font-weight: 700; margin-bottom: 15px;">
                        Computando resposta...
                    </div>
                    <div style="color: #ccc; font-size: 1em; margin-bottom: 25px;">
                        Identificando a melhor solu√ß√£o para voc√™
                    </div>
                    
                    <div style="
                        width: 300px;
                        height: 8px;
                        background: rgba(212, 175, 55, 0.2);
                        border-radius: 10px;
                        overflow: hidden;
                        margin: 0 auto;
                    ">
                        <div id="progress-bar-iniciante" style="
                            width: 0%;
                            height: 100%;
                            background: linear-gradient(90deg, #d4af37, #f4e5b1);
                            border-radius: 10px;
                            transition: width 0.3s ease;
                        "></div>
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);

            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                const bar = document.getElementById('progress-bar-iniciante');
                if (bar) bar.style.width = progress + '%';
                if (progress >= 100) clearInterval(interval);
            }, 100);
        }

        function mostrarPopupIniciante() {
            const overlay = document.createElement('div');
            overlay.id = 'popup-iniciante';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: flex-start;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
                overflow-y: auto;
                padding: 80px 20px 20px 20px;
            `;

            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                    border: 3px solid #d4af37;
                    border-radius: 20px;
                    padding: 50px;
                    max-width: 700px;
                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.5);
                    animation: slideUp 0.4s ease;
                ">
                    <div style="font-size: 3em; text-align: center; margin-bottom: 10px;">üìö</div>
                    
                    <div style="color: #d4af37; font-size: 2em; font-weight: 700; text-align: center; margin-bottom: 30px; line-height: 1.15;">
                        RESULTADO DA AN√ÅLISE:<br>
                        Voc√™ precisa aprender Perfumaria Masculina!
                    </div>
                    
                    <div style="
                        color: #f4e5b1;
                        font-size: 1.2em;
                        line-height: 1.8;
                        margin-bottom: 35px;
                        text-align: center;
                        padding: 20px;
                        background: rgba(212, 175, 55, 0.1);
                        border-radius: 10px;
                    ">
                        Voc√™ ainda n√£o sabe, mas est√° <strong style="color: #fff;">perdendo a chance de ser memor√°vel</strong>, de se sentir e estar bem. Com a Perfumaria, voc√™ deixa de ser mais um e passa a ser <strong style="color: #d4af37;">inesquec√≠vel</strong>.
                    </div>
                    
                    <div style="
                        color: #fff;
                        font-size: 1.15em;
                        line-height: 1.8;
                        margin-bottom: 35px;
                        text-align: center;
                        padding: 25px;
                        background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(212, 175, 55, 0.05));
                        border-left: 4px solid #d4af37;
                        border-radius: 10px;
                    ">
                        Descubra como <strong style="color: #d4af37;">homens como voc√™</strong> v√™m sendo <strong style="color: #f4e5b1;">notados, admirados e respeitados</strong> apenas porque passaram a entender como usar perfumes ao seu favor, <strong style="color: #fff;">na hora e na ocasi√£o certa</strong>. <strong style="color: #d4af37;">E eu quero que voc√™ seja como eles.</strong> Tudo que voc√™ precisa √© o <strong style="color: #f4e5b1;">Guia da Perfumaria Masculina</strong>.
                    </div>
                    
                    <div style="
                        background: rgba(0, 0, 0, 0.3);
                        padding: 30px;
                        border-radius: 12px;
                        margin-bottom: 30px;
                    ">
                        <div style="color: #d4af37; font-size: 1.4em; font-weight: 700; margin-bottom: 20px; text-align: center; line-height: 1.3;">
                            üì¶ O que voc√™ vai receber no Guia de Perfumaria Masculina:
                        </div>
                        
                        <div style="color: #fff; font-size: 1.05em; line-height: 1.8;">
                            ü§ñ <strong>O Perfumista</strong> - Agente de I.A. 24 horas ao seu lado para te mostrar a sugest√£o perfeita para cada ocasi√£o.<br><br>
                            üìö <strong>Fam√≠lias Olfativas</strong> - Entenda os tipos, caracter√≠sticas e quando e onde usar cada uma. Aqui voc√™ vai parar de afastar as pessoas e vai come√ßar a conquist√°-las sem soltar uma palavra!<br><br>
                            ‚úÖ <strong>Boas Pr√°ticas</strong> - Como aplicar e armazenar corretamente. N√£o adianta conhecer perfumes. Tem que saber como usar e como guardar. Voc√™ n√£o quer exagerar e ganhar a m√°-fama de exagerado, n√£o √©?
                        </div>
                    </div>
                    
                    <a href="https://pay.hotmart.com/H102542620H?checkoutMode=10" target="_blank" style="text-decoration: none;" onclick="trackCTAClick('Guia - Popup Iniciante'); return true;">
                        <button style="
                            width: 100%;
                            background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                            color: #1e1e1e;
                            border: none;
                            padding: 20px 50px;
                            border-radius: 12px;
                            font-size: 1.4em;
                            font-weight: 700;
                            cursor: pointer;
                            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.5);
                            transition: all 0.3s ease;
                            margin-bottom: 20px;
                        " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(212, 175, 55, 0.7)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(212, 175, 55, 0.5)';">
                            üöÄ QUERO O GUIA AGORA!
                        </button>
                    </a>
                    
                    <div style="color: #888; font-size: 0.9em; cursor: pointer; margin-top: 15px; text-align: center;" onclick="fecharPopupIniciante()">
                        Fechar (ou pressione ESC)
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') fecharPopupIniciante();
            });
        }

        function fecharPopupIniciante() {
            const popup = document.getElementById('popup-iniciante');
            if (popup) popup.remove();
        }

        // Popup de convers√£o
        function abrirPopupConversao() {
            // ENVIAR DADOS: Clicou no bot√£o de I.A.
            sendToSheet({
                etapa: 'Clicou I.A.',
                q1: quizAnswers.q1,
                q2: quizAnswers.q2,
                q3: quizAnswers.q3,
                clicouIA: 'Sim',
                status: 'Interesse em Compra'
            });

            const overlay = document.createElement('div');
            overlay.id = 'popup-conversao';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
                animation: fadeIn 0.3s ease;
            `;

            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #2d2d2d 0%, #1e1e1e 100%);
                    border: 3px solid #d4af37;
                    border-radius: 20px;
                    padding: 50px;
                    max-width: 600px;
                    box-shadow: 0 20px 60px rgba(212, 175, 55, 0.5);
                    animation: slideUp 0.4s ease;
                    text-align: center;
                ">
                    <div style="font-size: 4em; margin-bottom: 20px;">üîì</div>
                    <div style="color: #d4af37; font-size: 2em; font-weight: 700; margin-bottom: 20px;">
                        An√°lise Completa Bloqueada
                    </div>
                    <div style="color: #ccc; font-size: 1.1em; line-height: 1.8; margin-bottom: 30px;">
                        A an√°lise completa com:<br><br>
                        ‚úÖ <strong style="color: white;">Recomenda√ß√µes personalizadas</strong> de perfumes<br>
                        ‚úÖ <strong style="color: white;">Consultoria com I.A.</strong> especializada<br>
                        ‚úÖ <strong style="color: white;">Plano de a√ß√£o completo</strong> para sua cole√ß√£o<br><br>
                        Est√° dispon√≠vel apenas para alunos do<br>
                        <strong style="color: #d4af37; font-size: 1.2em;">Guia da Perfumaria Masculina</strong>
                    </div>
                    
                    <a href="https://pay.hotmart.com/H102542620H?checkoutMode=10" target="_blank" style="text-decoration: none;">
                        <button style="
                            background: linear-gradient(135deg, #d4af37 0%, #f4e5b1 100%);
                            color: #1e1e1e;
                            border: none;
                            padding: 20px 50px;
                            border-radius: 12px;
                            font-size: 1.3em;
                            font-weight: 700;
                            cursor: pointer;
                            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.5);
                            transition: all 0.3s ease;
                            margin-bottom: 20px;
                        " onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 15px 40px rgba(212, 175, 55, 0.7)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 10px 30px rgba(212, 175, 55, 0.5)';">
                            üöÄ ACESSAR O CURSO COMPLETO
                        </button>
                    </a>
                    
                    <div style="color: #888; font-size: 0.9em; cursor: pointer; margin-top: 15px;" onclick="fecharPopup()">
                        Fechar (ou pressione ESC)
                    </div>
                </div>
            `;

            document.body.appendChild(overlay);

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') fecharPopup();
            });
        }

        function fecharPopup() {
            const popup = document.getElementById('popup-conversao');
            if (popup) popup.remove();
        }

        // Salvar contadores
        ['fresco', 'aromatico', 'doce', 'amadeirado', 'especiado', 'aquatico', 'talco'].forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('change', function() {
                    localStorage.setItem(`count_${id}`, this.value);
                });
                
                const saved = localStorage.getItem(`count_${id}`);
                if (saved) {
                    input.value = saved;
                }
            }
        });

        // Mapeamento de cidades por estado com clima

        // Salvar ambiente
        const ambienteSelect = document.getElementById('ambiente');
        if (ambienteSelect) {
            ambienteSelect.addEventListener('change', function() {
                localStorage.setItem('ambiente', this.value);
            });
            const savedAmbiente = localStorage.getItem('ambiente');
            if (savedAmbiente) {
                ambienteSelect.value = savedAmbiente;
            }
        }

        // Salvar or√ßamento



        // LIMITAR SELE√á√ÉO DE FAM√çLIAS A 3 (executa ap√≥s DOM carregar)
        document.addEventListener('DOMContentLoaded', function() {
            let familiasOrdem = []; // Array para manter ordem de sele√ß√£o
            
            document.querySelectorAll('.familia-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        familiasOrdem.push(this);
                        
                        
                        // Destacar selecionada
                        this.parentElement.style.background = 'rgba(212, 175, 55, 0.2)';
                        this.parentElement.style.borderColor = '#d4af37';
                        this.parentElement.style.boxShadow = '0 0 15px rgba(212, 175, 55, 0.4)';
                    } else {
                        // Remover da ordem
                        const index = familiasOrdem.indexOf(this);
                        if (index > -1) {
                            familiasOrdem.splice(index, 1);
                        }
                        
                        // Remover destaque
                        this.parentElement.style.background = 'rgba(255, 255, 255, 0.05)';
                        this.parentElement.style.borderColor = 'rgba(212, 175, 55, 0.3)';
                        this.parentElement.style.boxShadow = 'none';
                    }
                });
            });
        });

        // Restaurar clima salvo
        const savedClima = localStorage.getItem('clima');
        if (savedClima) {
            document.getElementById('clima').value = savedClima;
            const climaBtn = document.querySelector(`.clima-btn[onclick*="${savedClima}"]`);
            if (climaBtn) {
                // Remover todas as classes de sele√ß√£o
                document.querySelectorAll('.clima-btn').forEach(b => {
                    b.classList.remove('selected-quente');
                    b.classList.remove('selected-temperado');
                    b.classList.remove('selected-frio');
                });
                // Adicionar classe espec√≠fica
                climaBtn.classList.add('selected-' + savedClima);
            }
        }
        // Prote√ß√£o anti-c√≥pia nas sugest√µes personalizadas
        document.addEventListener('DOMContentLoaded', function() {
            // Previne copiar, recortar e arrastar nas sugest√µes borradas
            document.addEventListener('copy', function(e) {
                const selection = window.getSelection().toString();
                // Bloqueia se a sele√ß√£o cont√©m texto das sugest√µes
                if (selection.includes('PRIORIDADE') || 
                    selection.includes('Dior Sauvage') || 
                    selection.includes('Acqua di Gio') || 
                    selection.includes('Spicebomb')) {
                    e.preventDefault();
                    return false;
                }
            });
            
            document.addEventListener('cut', function(e) {
                const selection = window.getSelection().toString();
                if (selection.includes('PRIORIDADE') || 
                    selection.includes('Dior Sauvage') || 
                    selection.includes('Acqua di Gio') || 
                    selection.includes('Spicebomb')) {
                    e.preventDefault();
                    return false;
                }
            });
        });
        
        // ============================================
        // EXIT INTENT POPUP
        // ============================================
        
        let exitIntentShown = false;
        
        // Fun√ß√£o para abrir popup de sa√≠da quando clicar no X
        function abrirPopupSaidaDiferenciado() {
            const popup = document.getElementById('popup-exit-intent');
            if (popup) {
                popup.style.display = 'flex';
                
                // Track evento
                trackEvent('exit_via_x_button');
                console.log('‚ùå Usu√°rio clicou no X - Oferecendo 2 sugest√µes');
            }
        }
        
        // Mostrar popup de exit intent (fun√ß√£o mantida para compatibilidade)
        function mostrarExitPopup() {
            abrirPopupSaidaDiferenciado();
        }
        
        // Fechar popup de exit intent
        function fecharExitPopup() {
            const popup = document.getElementById('popup-exit-intent');
            if (popup) {
                popup.style.display = 'none';
                
                // Track evento
                trackEvent('exit_intent_closed');
                console.log('‚ùå Exit intent popup fechado');
            }
        }
        
        // Verificar rate limit (5 minutos)
        function verificarRateLimit(email) {
            const RATE_LIMIT_KEY = 'exit_intent_emails';
            const RATE_LIMIT_MINUTES = 5;
            
            // Pegar hist√≥rico do localStorage
            let emailHistory = {};
            try {
                const stored = localStorage.getItem(RATE_LIMIT_KEY);
                if (stored) {
                    emailHistory = JSON.parse(stored);
                }
            } catch (e) {
                console.error('‚ùå Erro ao ler rate limit:', e);
            }
            
            const now = Date.now();
            const emailKey = email.toLowerCase().trim();
            
            // Verificar se email foi usado recentemente
            if (emailHistory[emailKey]) {
                const lastUsed = emailHistory[emailKey];
                const minutesAgo = (now - lastUsed) / 1000 / 60;
                
                console.log(`‚è∞ Email "${email}" usado h√° ${minutesAgo.toFixed(1)} minutos`);
                
                if (minutesAgo < RATE_LIMIT_MINUTES) {
                    const remaining = Math.ceil(RATE_LIMIT_MINUTES - minutesAgo);
                    return {
                        allowed: false,
                        minutesRemaining: remaining
                    };
                }
            }
            
            // Limpar emails antigos (mais de 1 hora)
            Object.keys(emailHistory).forEach(key => {
                const age = (now - emailHistory[key]) / 1000 / 60;
                if (age > 60) {
                    delete emailHistory[key];
                }
            });
            
            // Salvar novo timestamp
            emailHistory[emailKey] = now;
            try {
                localStorage.setItem(RATE_LIMIT_KEY, JSON.stringify(emailHistory));
            } catch (e) {
                console.error('‚ùå Erro ao salvar rate limit:', e);
            }
            
            return { allowed: true };
        }
        
        // Enviar sugest√£o via exit intent
        async function enviarExitIntent(event) {
            event.preventDefault();
            
            const emailInput = document.getElementById('exit-email');
            const submitBtn = document.getElementById('exit-submit-btn');
            const errorMsg = document.getElementById('exit-error-msg');
            const successMsg = document.getElementById('exit-success-msg');
            
            const email = emailInput.value.trim();
            
            // Esconder mensagens
            errorMsg.style.display = 'none';
            successMsg.style.display = 'none';
            
            console.log('üìß [EXIT INTENT] Tentando enviar para:', email);
            
            // Verificar rate limit
            const rateCheck = verificarRateLimit(email);
            if (!rateCheck.allowed) {
                console.warn(`‚è∞ [RATE LIMIT] Email bloqueado. Aguarde ${rateCheck.minutesRemaining} minuto(s)`);
                
                errorMsg.textContent = `‚ùå Voc√™ j√° recebeu uma sugest√£o! Verifique seu email ou use outro endere√ßo.`;
                errorMsg.style.display = 'block';
                
                // Track bloqueio
                trackEvent('exit_intent_rate_limited', { email, minutesRemaining: rateCheck.minutesRemaining });
                
                return;
            }
            
            // Desabilitar bot√£o
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ ENVIANDO...';
            
            try {
                // Pegar TOP 2 perfumes (sem considerar fam√≠lia)
                const allPerfumes = PERFUMES_DATABASE.map(p => ({
                    ...p,
                    score: Math.random() * 100 // Score aleat√≥rio para variedade
                })).sort((a, b) => b.score - a.score);
                
                const perfume1 = allPerfumes[0];
                const perfume2 = allPerfumes[1];
                
                console.log('üéØ Perfumes selecionados:');
                console.log('   #1:', perfume1.nome);
                console.log('   #2:', perfume2.nome);
                
                // Preparar dados do email com 2 perfumes
                const emailParams = {
                    to_email: email,
                    to_name: 'Amigo',
                    // Perfume #1
                    perfume_nome: perfume1.nome,
                    perfume_marca: perfume1.marca,
                    perfume_familia: perfume1.familia,
                    perfume_notas: perfume1.notas,
                    perfume_preco: perfume1.preco,
                    perfume_desc: perfume1.desc,
                    // Perfume #2
                    perfume2_nome: perfume2.nome,
                    perfume2_marca: perfume2.marca,
                    perfume2_familia: perfume2.familia,
                    perfume2_notas: perfume2.notas,
                    perfume2_preco: perfume2.preco,
                    perfume2_desc: perfume2.desc,
                    tipo_envio: 'Exit Intent - 2 Sugest√µes Upgrade'
                };
                
                console.log('üìß Enviando email via EmailJS...');
                
                // Enviar via EmailJS - Template Exit Intent (2 Perfumes)
                const response = await emailjs.send(
                    'service_gy6byvf',
                    'template_mukicfc',  // Template: "2 Perfumes Popup Sa√≠da"
                    emailParams
                );
                
                console.log('‚úÖ Email enviado!', response);
                
                // Mostrar sucesso
                successMsg.textContent = `‚úÖ Enviado! Confira 2 sugest√µes no seu email: "${perfume1.nome}" e "${perfume2.nome}"!`;
                successMsg.style.display = 'block';
                
                // Limpar formul√°rio
                emailInput.value = '';
                
                // Track sucesso
                trackEvent('exit_intent_2_sugestoes_sent', { 
                    email, 
                    perfume1: perfume1.nome,
                    perfume2: perfume2.nome
                });
                
                // Enviar para Google Sheets
                const sheetData = {
                    timestamp: new Date().toLocaleString('pt-BR'),
                    email: email,
                    tipo: 'Exit Intent (2 Sugest√µes)',
                    perfume: `${perfume1.nome} + ${perfume2.nome}`,
                    familia: `${perfume1.familia} + ${perfume2.familia}`
                };
                
                console.log('üìä Enviando para Google Sheets:', sheetData);
                
                const sheetUrl = `https://script.google.com/macros/s/AKfycbwVsf5BS_uSNmcGHzM8NTXlhquBXQ7qwejle6NpB7g4rUfdXnIkGrqW937ZeOXp9xQ/exec?${new URLSearchParams(sheetData)}`;
                
                await fetch(sheetUrl, { method: 'GET', mode: 'no-cors' });
                console.log('‚úÖ Dados enviados para Google Sheets!');
                
                // Fechar popup ap√≥s 3 segundos
                setTimeout(() => {
                    fecharExitPopup();
                }, 3000);
                
            } catch (error) {
                console.error('‚ùå Erro ao enviar:', error);
                
                errorMsg.textContent = '‚ùå Erro ao enviar. Tente novamente!';
                errorMsg.style.display = 'block';
                
                // Track erro
                trackEvent('exit_intent_error', { error: error.message });
            } finally {
                // Reabilitar bot√£o
                submitBtn.disabled = false;
                submitBtn.textContent = 'üéÅ SIM, QUERO MINHA SUGEST√ÉO!';
            }
        }
        
        // Fechar popup com ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                fecharExitPopup();
            }
        });
    </script>
</body>
</html>